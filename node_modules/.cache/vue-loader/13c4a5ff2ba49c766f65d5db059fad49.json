{"remainingRequest":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/index.js??vue-loader-options!/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/src/components/AddCustomer.vue?vue&type=style&index=0&id=b8acfbc2&scoped=true&lang=css&","dependencies":[{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/src/components/AddCustomer.vue","mtime":1581270622000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLm5vdGUgewogIGFuaW1hdGlvbjogLjM1cyBjdWJpYy1iZXppZXIoMC4xNjUsIDAuODQsIDAuNDQsIDEpIHNsaWRlRnJvbVRvcDsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgcGFkZGluZzogMTRweDsKICBiYWNrZ3JvdW5kOiAjRkFGQUZBOwogIGNvbG9yOiAjNzU3NTc1OwogIGhlaWdodDogNDBweDsKICB3aWR0aDogMTAwJTsKICBtYXJnaW4tdG9wOiAxMHB4OwogIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGZvbnQtd2VpZ2h0OiBtZWRpdW07CiAgbGluZS1oZWlnaHQ6IDI0cHg7CiAgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwgMCwgMCwgLjE1KTsKICB0cmFuc2l0aW9uOiBhbGwgMXMgZWFzZTsKfQoKLm5vdGUgaSB7CiAgcGFkZGluZy1sZWZ0OiAyMHB4OwogIGNvbG9yOiAjREQyQzAwOwogIGN1cnNvcjogcG9pbnRlcjsKICB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOwp9Ci50ZXh0YXJlYSB7CiAgbWFyZ2luLXRvcDogMjBweDsKfQouaW5wdXQtc2VsZWN0b3IgewogIHdpZHRoOiAyNjBweDsKfQoud3JhcHBlciB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwp9Ci5pbnB1dC1jb250YWluZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgbWFyZ2luLXRvcDogMTBweDsKICB3aWR0aDogMTAwJTsKICBtYXgtd2lkdGg6IDEwMCU7Cn0KCi5pbnB1dC1jb250YWluZXIgLmlucHV0LWRyb3Bkb3duLWxhYmVsewogIGZvbnQtc2l6ZTogMThweDsgCiAgZm9udC13ZWlnaHQ6IG1lZGl1bTsKICBjb2xvcjogIzc1NzU3NTsKfQoKLmlucHV0LWxhYmVsIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KLmVsLWlucHV0IHsKICBtaW4td2lkdGg6IDI2MHB4OwogIG1heC13aWR0aDogMjYwcHg7CiAgcGFkZGluZy10b3A6IDVweDsKfQouZWwtaW5wdXRfX2lubmVyIHsKICBib3JkZXItcmFkaXVzOiAxMDAwcHg7Cn0KLmRpYWxvZy1mb290ZXIgYnV0dG9uIHsKICB3aWR0aDogMjYwcHg7Cn0KCg=="},{"version":3,"sources":["AddCustomer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AddCustomer.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-dialog class=\"rounded\" title=\"Add New Customer\" width=\"600px\" center :show-close=\"false\" :visible.sync=\"addCustomerOpen\" :before-close=\"closeModal\">\n    <el-form :model=\"customer\" ref=\"customerForm\" :rules=\"customerRules\">\n      <div class=\"input-container\">\n        <label class=\"input-label\"> First Name\n          <el-input type=\"text\" placeholder=\"First Name\" v-model=\"customer.firstName\"></el-input>\n        </label>\n        <label class=\"input-label\"> Last Name\n          <el-input type=\"text\" placeholder=\"Last Name\" v-model=\"customer.lastName\"></el-input>\n        </label>\n      </div>\n      <div class=\"input-container\">\n        <label class=\"input-label\"> Email\n          <el-form-item prop=\"email\">\n            <el-input :class=\"{'duplicate': emailDuplicate}\" @blur=\"validateEmail(); checkDuplicate($event, 'email', customer.email, customer.locationId );\" @change=\"validateAfterChange('customerForm');\" type=\"email\" placeholder=\"Email\" v-model=\"customer.email\"></el-input>\n            </el-form-item>\n            <div class=\"duplicate-message\" v-if=\"emailDuplicate\">This email address is associated with an existing customer! Please utilize the re-request functionality instead.</div>\n            <div class=\"duplicate-message\" v-if=\"inactiveDupe\">This email address is associated with an inactive customer! Saving this customer will activate them and re-request a review.</div>\n        </label>\n        <label class=\"input-label\"> Phone\n          <el-form-item prop=\"phone\">\n            <el-input type=\"tel\" placeholder=\"Phone\" v-model=\"customer.phone\" @change=\"validateAfterChange('customerForm');\"></el-input>\n            <div class=\"duplicate-message\" v-if=\"phoneDuplicate\">This phone number is associated with an existing customer! Please utilize the re-request functionality instead.</div>\n            <div class=\"duplicate-message\" v-if=\"inactiveDupe\">This phone number is associated with an inactive customer! Saving this customer will activate them and re-request a review.</div>\n          </el-form-item>\n        </label>\n      </div>\n      <div class=\"input-container\">\n        <label class=\"input-dropdown-label\">Location:</label>\n        <el-form-item prop=\"locationId\">\n          <el-select class=\"input-selector\" v-model=\"customer.locationId\" placeholder=\"Select Location\" @change=\"getLocationTemplates()\">\n            <el-option v-for=\"(location, index) in locationOptions\" :key=\"index\" :label=\"location.label\" :value=\"location.value\"></el-option>\n          </el-select>\n        </el-form-item>\n      </div>\n      <div class=\"input-container\">\n        <label class=\"input-dropdown-label\">Status:</label>\n        <el-select class=\"input-selector\" v-model=\"customer.status\" placeholder=\"Select Status\">\n          <el-option v-for=\"(status, index) in statusOptions\" :key=\"index\" :label=\"status.label\" :value=\"status.value\"></el-option>\n        </el-select>\n      </div>\n      <div class=\"input-container\">\n        <label class=\"input-dropdown-label\">Country:</label>\n        <el-select class=\"input-selector\" v-model=\"customer.country\" placeholder=\"Select Country\">\n          <el-option v-for=\"(country, index) in countryOptions\" :key=\"index\" :label=\"country.country\" :value=\"country.code\"></el-option>\n        </el-select>\n      </div>\n      <div class=\"input-container\" v-if=\"customer.locationId\">\n        <label class=\"input-dropdown-label\">Template:</label>\n        <el-select class=\"input-selector\" v-model=\"customer.campaignId\" placeholder=\"Select Template\">\n          <el-option v-for=\"(template, index) in templateOptions\" :key=\"index\" :label=\"template.name\" :value=\"template.campaignId\"></el-option>\n        </el-select>\n      </div>\n      <div class=\"note-list\" ref=\"notelist\" v-if=\"customer.notes && customer.notes.length && typeof customer.notes != 'string'\">\n        <div class=\"note\" v-for=\"(note, noteIndex) in customer.notes\" :key=\"noteIndex\">\n          <span>{{note}}</span>\n          <i class=\"fal fa-times\" @click=\"removeNote(noteIndex)\"></i>\n        </div>\n      </div>\n      <el-input type=\"textarea\" class=\"textarea\" placeholder=\"Type a note and press enter...\" maxlength=\"125\" show-word-limit v-model=\"tempNote\" @keyup.enter.native=\"addNote()\"></el-input>\n    </el-form>\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button type=\"text\" @click=\"$emit('closeModal')\">Cancel</el-button>\n      <el-button type=\"primary\" @click=\"validateCustomer('customerForm')\">Confirm</el-button>\n    </span>\n  </el-dialog>      \n</template>\n\n<script>\nimport CustomerService from \"./../services/CustomerService\";\nimport CampaignService from \"./../services/CampaignService\";\nimport LocationService from \"./../services/LocationService\";\nimport UserService from \"./../services/UserService\";\nimport SharedFunctions from \"./../services/SharedFunctions\";\nimport { EventService } from \"../main\";\nimport vSelect from \"../../node_modules/vue-select/src/components/Select.vue\";\n\nexport default {\n  name: \"addCustomer\",\n  props: [\"selectedCustomer\", \"openCustomerModal\"],\n  components: {\n    vSelect\n  },\n  data: function() {\n    var checkData = (rule, value, callback) => {\n      if(!this.customer.email && !this.customer.phone) {\n        return callback(new Error('Phone or Email is Required'))\n      } else {\n        callback();\n      }\n    };\n    return {\n      pageAction: \"Create New\",\n      customer: {\n        locationId: \"\",\n        status: \"active\",\n        template: \"\",\n        phone: \"\",\n        email: \"\",\n        country: \"+1\",\n        notes: [],\n        campaignId: ''\n      },\n      duplicateList: [],\n      templateOptions: [],\n      searchText: \"\",\n      locationObj: {},\n      locationOptions: [],\n      statusOptions: [\n        {value: 'active', label: 'Subscribed'}, \n        {value: 'inactive', label: 'Unsubscribed'}\n      ],\n      countryOptions: [\n        {country: 'USA / Canada', code: '+1'},\n        {country: 'Phillipines', code: '+63'},\n        {country: 'UAE', code: '+971'},\n        {country: 'Australia', code: '+61'}\n      ],\n      qsEnabled: false,\n      inactiveDupe: false,\n      emailDuplicate: false,\n      phoneDuplicate: false,\n      noLocation: false,\n      tempNote: '',\n      // openCustomerModal: true,\n      customerRules: {\n        email: [\n          { type: 'email', message: 'Please enter a valid email address', trigger: \"blur\"},\n          { validator: checkData, message: 'Phone or Email is Required', trigger: 'blur' }\n        ],\n        phone: [\n          { type: 'number', validator: checkData, message: 'Phone or Email is Required', trigger: 'blur' }\n        ],\n        locationId: [\n          {\n            required: true,\n            message: \"Please select a location\",\n            trigger: \"change\"\n          }\n        ]\n      },\n      addCustomerOpen: true,\n    };\n  },\n  created() {\n    this.locationChecking();\n    this.getLocationOptions();\n    this.validatePhone = SharedFunctions.validatePhone;\n    this.validateEmail = SharedFunctions.validateEmail;\n    this.validateNotes = SharedFunctions.validateNotes;\n    if(this.selectedCustomer) {\n      let tempStatus = this.selectedCustomer.status;\n      this.pageAction = \"Edit\"\n      this.data2 = {label: tempStatus[0].toUpperCase() + tempStatus.substr(1), value: tempStatus}\n    }\n  },\n  mounted() {\n    this.refreshNotes();\n  },\n  computed: {\n    checkNoteHeight() {\n      this.customer.notes;\n      this.customer.notes.length;\n      this.$refs.notelist;\n      if(this.customer.notes && this.customer.notes.length && this.$refs.notelist) {\n        // console.log(this.$refs);\n        if(this.$refs.notelist.clientHeight > 100) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n    },\n  },\n  methods: {\n    getLocationOptions() {\n      let vm = this;\n      UserService.getAllUserLocations().then(response => {\n        response.map(e => {\n          let singleLocation = {\n            label: e.name,\n            value: e.locationId,\n            prop: e.prop\n          }\n          vm.locationOptions.push(singleLocation);\n        })\n      });\n    },\n    locationChecking() {\n      var vm = this;\n      if (this.selectedCustomer) {\n        this.pageAction = \"Update\";\n        this.customer = this.selectedCustomer;\n        if (!this.customer.campaignId) this.data3 = \"default\";\n      } else {\n        this.customer.locationId = localStorage.getItem(\"locationId\");\n        if (\n          this.customer.locationId &&\n          this.customer.locationId == localStorage.getItem(\"locationId\")\n        ) {\n          vm.getLocationTemplates()\n        } else if (\n          this.customer.locationId && \n          this.customer.locationId != localStorage.getItem(\"locationId\")\n        ) {\n          LocationService.getLocation(this.customer.locationId).then(\n            response => {\n              vm.customer.locationId = response.locationId;\n            }\n          );\n          vm.getLocationTemplates()\n        } else {\n          null;\n        }\n      }\n    },\n    getLocationTemplates() {\n      let vm = this;\n      CampaignService.getCampaignsByLocation(vm.customer.locationId).then(response => {        \n        vm.templateOptions = response.result.filter(e => e.status === \"active\");\n      })\n    },\n    checkForLocation() {\n      if(!this.data) {\n        this.noLocation = true;\n      } else if (this.data) {\n        this.noLocation = false;\n      }\n    },\n    validateAfterChange(ruleForm) {\n      let vm = this;\n      vm.$refs[ruleForm].validate(valid => {\n        if (valid) {          \n        } else {\n          return false;\n        }\n      });\n    },\n    validateCustomer(ruleForm) {\n      let vm = this;\n      vm.$refs[ruleForm].validate(valid => {\n        if (valid) {\n          vm.saveCustomer();\n        } else {\n          return false;\n        }\n      });\n    },\n    saveCustomer() {\n      EventService.$emit(\"loading\", \"show\");\n      let vm = this;\n      CustomerService.saveCustomer(vm.customer).then(\n        function(response) {\n          if (response.success == true && !response.duplicate && !response.update) {\n            EventService.$emit(\"loading\", \"hide\");\n            if(response.campaigns == 'None') {\n              EventService.$emit(\n                \"successMessage\",\n                \"Hooray! Customer added, though there are no campaigns to send.\"\n              );\n            } else {\n              EventService.$emit(\n                \"successMessage\",\n                \"Hooray! Customer added and will be sent a message soon.\"\n              );\n            }\n            vm.customer.customerId = response.customerId;\n            vm.$emit(\"setActiveCustomer\", vm.customer);\n          } else if (response.success == true && response.duplicate) {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"warningMessage\",\n              \"Customer Already Exists At This Location!\"\n            );\n          } else if(response.success == true && response.update) {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"successMessage\",\n              \"Customer Has Been Updated!\"\n            );\n            vm.$emit(\"setActiveCustomer\", vm.customer);\n          }\n          vm.closeModal();\n        },\n        function(error) {\n          if (error) {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"errorMessage\",\n              \"Sorry, something went wrong. Please try again.\"\n            );\n          }\n          vm.closeModal();\n        }\n      );\n    },\n    closeModal: function() {\n      this.$emit(\"closeModal\");\n      this.customer = {};\n      this.addCustomerOpen = false;\n    },\n\n    getLocationQs(locationId) {\n      let vm = this;\n      LocationService.getLocation(locationId).then(response => {\n        vm.qsEnabled = response.qsEnabled;\n      })\n    },\n\n    refreshNotes() {\n      this.customer.notes.push('Temp');\n      this.customer.notes.pop();\n    },\n    addNote() {\n      let vm = this;\n      if(vm.tempNote.length) {\n        vm.customer.notes.push(vm.tempNote.trim());\n        vm.tempNote = '';\n      }\n    },\n    removeNote(index) {\n      let vm = this;\n      vm.customer.notes.splice(index, 1);\n    },\n    checkDuplicate(event, type, data, locationId) {\n      if (locationId) {\n        if (type == \"phone\") {\n          if (data) {\n            CustomerService.searchCustomers(data, locationId).then(response => {\n              if (\n                response.results &&\n                response.results.length > 0 &&\n                response.results[0].status != \"deleted\" &&\n                data && response.results[0].status == 'inactive'\n              ) {\n                this.inactiveDupe = true;\n              } else if(response.results &&\n                response.results.length > 0 &&\n                response.results[0].status != \"deleted\" &&\n                data && response.results[0].status == 'active'\n              ) {\n                this.phoneDuplicate = true;\n              } else {\n                this.inactiveDupe = false;\n                this.phoneDuplicate = false;\n              }\n            });\n          } else {\n            this.inactiveDupe = false;\n            this.phoneDuplicate = false;\n          }\n        } else if (type == \"email\") {\n          if (data) {\n            CustomerService.searchCustomers(data, locationId).then(response => {\n              if (\n                response.results &&\n                response.results.length > 0 &&\n                response.results[0].status != \"deleted\" &&\n                data && response.results[0].status == 'inactive'\n              ) {\n                this.inactiveDupe = true;\n              } else if(response.results &&\n                response.results.length > 0 &&\n                response.results[0].status != \"deleted\" &&\n                data && response.results[0].status == 'active'\n              ) {\n                this.emailDuplicate = true;\n              } else {\n                this.emailDuplicate = false;\n              }\n            });\n          } else {\n            this.emailDuplicate = false;\n            this.inactiveDupe = false;\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n\n.note {\n  animation: .35s cubic-bezier(0.165, 0.84, 0.44, 1) slideFromTop;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-sizing: border-box;\n  padding: 14px;\n  background: #FAFAFA;\n  color: #757575;\n  height: 40px;\n  width: 100%;\n  margin-top: 10px;\n  margin-bottom: 10px;\n  border-radius: 4px;\n  font-weight: medium;\n  line-height: 24px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, .15);\n  transition: all 1s ease;\n}\n\n.note i {\n  padding-left: 20px;\n  color: #DD2C00;\n  cursor: pointer;\n  transform: rotate(360deg);\n}\n.textarea {\n  margin-top: 20px;\n}\n.input-selector {\n  width: 260px;\n}\n.wrapper {\n  display: flex;\n  justify-content: center;\n  flex-direction: column;\n}\n.input-container {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-top: 10px;\n  width: 100%;\n  max-width: 100%;\n}\n\n.input-container .input-dropdown-label{\n  font-size: 18px; \n  font-weight: medium;\n  color: #757575;\n}\n\n.input-label {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.el-input {\n  min-width: 260px;\n  max-width: 260px;\n  padding-top: 5px;\n}\n.el-input__inner {\n  border-radius: 1000px;\n}\n.dialog-footer button {\n  width: 260px;\n}\n\n</style>\n"]}]}