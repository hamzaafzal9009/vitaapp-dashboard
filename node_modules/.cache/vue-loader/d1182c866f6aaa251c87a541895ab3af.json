{"remainingRequest":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/index.js??vue-loader-options!/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/src/components/AddNewAutomation.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/src/components/AddNewAutomation.vue","mtime":1581270622000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Library/WebServer/Documents/Projects/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEV2ZW50U2VydmljZSB9IGZyb20gIi4uL21haW4iOwppbXBvcnQgQXV0b21hdGlvblNlcnZpY2UgZnJvbSAiLi8uLi9zZXJ2aWNlcy9BdXRvbWF0aW9uU2VydmljZSI7CmltcG9ydCBjb25maWcgZnJvbSAiLi4vY29uZmlnLmpzIjsKaW1wb3J0IExvY2F0aW9uU2VydmljZSBmcm9tICIuLy4uL3NlcnZpY2VzL0xvY2F0aW9uU2VydmljZS5qcyI7CmltcG9ydCBQcmV2aWV3TGFuZGluZyBmcm9tICIuL1ByZXZpZXdMYW5kaW5nIjsKaW1wb3J0IFRDUEFDb21wbGlhbmNlIGZyb20gIi4vVENQQUNvbXBsaWFuY2UiOwppbXBvcnQgVXNlclNlcnZpY2UgZnJvbSAnLi8uLi9zZXJ2aWNlcy9Vc2VyU2VydmljZSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImFkZEF1dG9tYXRpb24iLAogIHByb3BzOiBbInNlbGVjdGVkQXV0b21hdGlvbiIsICJhdXRvbWF0aW9uVHlwZSJdLAogIGNvbXBvbmVudHM6IHsKICAgIFByZXZpZXdMYW5kaW5nLCBUQ1BBQ29tcGxpYW5jZQogIH0sCiAgZGF0YTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gewogICAgICBwYWdlQWN0aW9uOiAiQWRkIE5ldyIsCiAgICAgIGRpc3BsYXlOYW1lOiAiIiwKICAgICAgbG9jYXRpb25JZDogIiIsCiAgICAgIGF1dG9tYXRpb25Mb2NhdGlvbk5hbWU6ICcnLAogICAgICB1c2VyRGF0YTogJycsCiAgICAgIG5ld09wdGlvbjogJycsCiAgICAgIHRlbXBNZXNzYWdlOiAnJywKICAgICAgbGFuZGluZ01lc3NhZ2U6ICdFZGl0IExhbmRpbmcgUGFnZScsCiAgICAgIGVtYWlsUHJldmlldzogZmFsc2UsCiAgICAgIHNtc1ByZXZpZXc6IGZhbHNlLAogICAgICBkdXBsaWNhdGVJZDogZmFsc2UsCiAgICAgIGR1cGxpY2F0ZUtleTogZmFsc2UsCiAgICAgIGVkaXRpbmdUaW1lQ29uZGl0aW9uOiBmYWxzZSwKICAgICAgZWRpdGluZ0xhbmRpbmdQYWdlOiBmYWxzZSwKICAgICAgZWRpdGluZ1N1cnZleTogZmFsc2UsCiAgICAgIGFkZGluZ0xveWFsdHlDb3Vwb246IGZhbHNlLAogICAgICBvcGVuUHJldmlld0NhbXBhaWduOiBmYWxzZSwKICAgICAgdGNwYUNvbXBsaWFuY2VPcGVuOiBmYWxzZSwKICAgICAgYWdyZWVtZW50OiBmYWxzZSwKICAgICAgaW5pdGlhbGl6ZWRVbmxheWVyOiBmYWxzZSwKICAgICAgc3Bpbm5lckFjdGl2ZTogZmFsc2UsCiAgICAgIHN0YXJ0UG9zaXRpb246IG51bGwsCiAgICAgIGVuZFBvc2l0aW9uOiBudWxsLAogICAgICBkcmFnZ2luZzogZmFsc2UsCiAgICAgIHRlbXBsYXRlVHlwZTogIiIsCiAgICAgIHNlbGVjdGVkSW5kZXg6IG51bGwsCiAgICAgIHNlbGVjdGVkQWN0aW9uOiB7CiAgICAgICAgdGltZTogMCwKICAgICAgICBlbWFpbDogewogICAgICAgICAgYWN0aXZlOiAnJywKICAgICAgICAgIHN1YmplY3Q6ICIiLAogICAgICAgICAgZGVzaWduOiB7CiAgICAgICAgICAgIGRhdGE6ICIiLAogICAgICAgICAgICBkZXNpZ246ICIiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzbXM6IHsKICAgICAgICAgIGFjdGl2ZTogJycsCiAgICAgICAgICBwcmV2aWV3OiAiIiwKICAgICAgICAgIG1lc3NhZ2U6ICIiCiAgICAgICAgfSwKICAgICAgICBzdXJ2ZXlRdWVzdGlvbnM6IFtdCiAgICAgICAgLy8gcmVzdHJpY3Rpb246ICcnCiAgICAgIH0sCiAgICAgIGF1dG9tYXRpb246IHsKICAgICAgICBuYW1lOiAiIiwKICAgICAgICBhdXRvbWF0aW9uSWQ6ICcnLAogICAgICAgIGxvY2F0aW9uSWQ6ICcnLAogICAgICAgIHR5cGU6ICIiLAogICAgICAgIGxhbmd1YWdlOiAnZW4nLAogICAgICAgIGlkZW50aWZpZXI6ICcnLAogICAgICAgIHRyaWdnZXJFdmVudDogIiIsCiAgICAgICAgYXV0b1Jlc2VuZDogJzE1NzI0ODAwMDAwJywKICAgICAgICBrZXl3b3JkOiAnJywKICAgICAgICBsYW5kaW5nUGFnZTogewogICAgICAgICAgbHAxOiAnJywKICAgICAgICAgIGxwMjogJycsCiAgICAgICAgICBscDM6ICcnLAogICAgICAgICAgcnAxOiAnJywKICAgICAgICAgIHJwMjogJycsCiAgICAgICAgICBycDM6ICcnCiAgICAgICAgfSwKICAgICAgICBhY3Rpb25zOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHRpbWU6IDAsCiAgICAgICAgICAgIGVtYWlsOiB7CiAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgICAgIHN1YmplY3Q6ICIiLAogICAgICAgICAgICAgIGRlc2lnbjogewogICAgICAgICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICAgICAgICBkZXNpZ246ICIiCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzbXM6IHsKICAgICAgICAgICAgICBhY3RpdmU6IHRydWUsCiAgICAgICAgICAgICAgcHJldmlldzogIiIsCiAgICAgICAgICAgICAgbWVzc2FnZToKICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlc3RyaWN0aW9uOiAiIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnNldEluaXRpYWxEYXRhKCk7CiAgICBsZXQgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RpdGxlZCcpOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGxhbmRpbmdQYWdlKCkgewogICAgICByZXR1cm4gewogICAgICAgIGxwMTogIkhvdyBBcmUgV2UgRG9pbmc/IiwKICAgICAgICBscDI6ICJQbGVhc2UgUmF0ZSBZb3VyIEV4cGVyaWVuY2UiLAogICAgICAgIGxwMzogIkF0ICIgKyB0aGlzLmF1dG9tYXRpb25Mb2NhdGlvbk5hbWUgKyAiLCB3ZSBjYXJlIGFib3V0IHlvdXIgZXhwZXJpZW5jZSBhbmQgd2FudCB0byBoZWFyIGFib3V0IGl0LiBQbGVhc2UgdGFrZSBhIG1vbWVudCB0byBsZXQgdXMga25vdyBob3cgd2UncmUgZG9pbmchIiwKICAgICAgICBycDE6ICJXZSdyZSBTb3JyeSBUbyBIZWFyIFRoYXQiLAogICAgICAgIHJwMjogIlBsZWFzZSBUZWxsIFVzIE1vcmUiLAogICAgICAgIHJwMzoKICAgICAgICAiV2UgdGFrZSBvdXIgY3VzdG9tZXIgZmVlZGJhY2sgdmVyeSBzZXJpb3VzbHkgLSBwbGVhc2UgbGV0IHVzIGtub3cgaG93IHlvdXIgZXhwZXJpZW5jZSB3YXMgbGVzcyB0aGFuIGlkZWFsIHNvIHdlIGNhbiBpbXByb3ZlIGluIHRoZSBmdXR1cmUuIEluIG9yZGVyIHRvIGJldHRlciBhZGRyZXNzIHRoZSBpc3N1ZSwgcGxlYXNlIHByb3ZpZGUgc3BlY2lmaWNzLiBXZSBhcHByZWNpYXRlIHlvdXIgZmVlZGJhY2shIgogICAgICB9CiAgICB9LAogICAgZGlzcGxheU92ZXJ2aWV3KCkgewogICAgICBpZiggdGhpcy5lbWFpbFByZXZpZXcgPT0gZmFsc2UgJiYKICAgICAgICAgIHRoaXMuc21zUHJldmlldyA9PSBmYWxzZSAmJgogICAgICAgICAgdGhpcy5lZGl0aW5nVGltZUNvbmRpdGlvbiA9PSBmYWxzZSAmJgogICAgICAgICAgdGhpcy5lZGl0aW5nTGFuZGluZ1BhZ2UgPT0gZmFsc2UgJiYKICAgICAgICAgIHRoaXMuZWRpdGluZ1N1cnZleSA9PSBmYWxzZSAmJgogICAgICAgICAgdGhpcy5hZGRpbmdMb3lhbHR5Q291cG9uID09IGZhbHNlICYmCiAgICAgICAgICB0aGlzLm9wZW5QcmV2aWV3Q2FtcGFpZ24gPT0gZmFsc2UgJiYKICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWRVbmxheWVyID09IGZhbHNlICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIHNhdmVTdXJ2ZXlEaXNhYmxlZCgpIHsKICAgICAgLy8gTmVlZHMgc29tZSBzb3J0IG9mIHRyaWdnZXIgaW4gb3JkZXIgdG8gcmVmcmVzaCB0aGUgcmVzdWx0IGFmdGVyIG9uZSBvZiBpdHMgZGVwZW5kZW50cyBpcyBjaGFuZ2VkLi4uIHVuc3VyZSBhdCB0aGlzIHRpbWUgaG93IHRvIHRyaWdnZXIgdGhhdC4KICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgbGV0IHRlc3QgPSB2bS5zZWxlY3RlZEFjdGlvbi5zdXJ2ZXlRdWVzdGlvbnM7CiAgICAgICByZXR1cm4odGVzdC5tYXAoZSA9PiB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGUpLm1hcCh4ID0+IHsKICAgICAgICAgIHJldHVybiAoeFsxXS5sZW5ndGggPT0gMCAmJiAodHlwZW9mIHhbMV0gIT0gJ2Jvb2xlYW4nIHx8IHR5cGVvZiB4WzFdICE9ICdudW1iZXInKSApOwogICAgICAgIH0pCiAgICAgIH0pKS5tYXAoaCA9PiB7CiAgICAgICAgcmV0dXJuIGguaW5jbHVkZXModHJ1ZSkKICAgICAgfSkKICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHNldEluaXRpYWxEYXRhKCkgewogICAgICB0aGlzLmxvY2F0aW9uSWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgibG9jYXRpb25JZCIpOwogICAgICB0aGlzLmF1dG9tYXRpb24ubG9jYXRpb25JZCA9IHRoaXMubG9jYXRpb25JZDsKICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IHRoaXMuYXV0b21hdGlvblR5cGU7CiAgICAgIHRoaXMuYXV0b21hdGlvbi50eXBlID0gdGhpcy5hdXRvbWF0aW9uVHlwZTsKICAgICAgdGhpcy5hZGRMYW5kaW5nUGFnZURhdGEoKTsKICAgICAgdGhpcy5hZGRTdXJ2ZXlEYXRhKCk7CiAgICAgIHRoaXMuYWRkTG95YWx0eUNvdXBvbigpOwogICAgICB0aGlzLmRpc3BsYXlOYW1lID0gdGhpcy5zcGxpdEFuZENvbnZlcnROYW1lKHRoaXMuZGlzcGxheU5hbWUpOwogICAgICBpZih0aGlzLnNlbGVjdGVkQXV0b21hdGlvbikgewogICAgICAgIHRoaXMucGFnZUFjdGlvbiA9ICdVcGRhdGUnOwogICAgICAgIHRoaXMuYXV0b21hdGlvbiA9IHRoaXMuc2VsZWN0ZWRBdXRvbWF0aW9uOwogICAgICB9CiAgICAgIHRoaXMuZ2V0VXNlckRhdGEoKTsKICAgICAgdGhpcy5jaGVja0FncmVlbWVudCgpOwogICAgfSwKICAgIGNoZWNrQWdyZWVtZW50KCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBpZih2bS5sb2NhdGlvbklkKSB7CiAgICAgICAgTG9jYXRpb25TZXJ2aWNlLmdldExvY2F0aW9uKHZtLmxvY2F0aW9uSWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYocmVzcG9uc2UudGNwYUFncmVlbWVudCkgewogICAgICAgICAgICB0aGlzLmFncmVlbWVudCA9IHJlc3BvbnNlLnRjcGFBZ3JlZW1lbnQuY29uc2VudDsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CiAgICB9LAogICAgY29udmVydFRvQ2FwcygpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgaWYodm0uYXV0b21hdGlvbiAmJiB2bS5hdXRvbWF0aW9uLmtleXdvcmQpIHZtLmF1dG9tYXRpb24ua2V5d29yZCA9IHZtLmF1dG9tYXRpb24ua2V5d29yZC50b1VwcGVyQ2FzZSgpLnJlcGxhY2UoL1xzKy9nLCAnJyk7CiAgICAgIGxldCBhbGxLZXlzID0gW10KICAgICAgQXV0b21hdGlvblNlcnZpY2UuZ2V0QXV0b21hdGlvbkJ5VHlwZShudWxsLCAnbG95YWx0eScpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIHJlc3BvbnNlLnJlc3VsdHMubWFwKGF1dG8gPT4gewogICAgICAgICAgYWxsS2V5cy5wdXNoKGF1dG8ua2V5d29yZCkKICAgICAgICB9KQogICAgICAgIHZtLmR1cGxpY2F0ZUtleSA9IGFsbEtleXMuaW5jbHVkZXModm0uYXV0b21hdGlvbi5rZXl3b3JkKSA/IHRydWUgOiBmYWxzZTsKICAgICAgfSkKICAgIH0sCiAgICBnZXRVc2VyRGF0YSgpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgdm0udXNlckRhdGEgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50VXNlcicpKTsKICAgIH0sCiAgICB2YWxpZGF0ZUlEKGlkKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIEF1dG9tYXRpb25TZXJ2aWNlLmdldEF1dG9tYXRpb25zQnlMb2NhdGlvbih2bS5sb2NhdGlvbklkLCB2bS5hdXRvbWF0aW9uLnR5cGUpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGxldCBsb2NhdGlvbkF1dG9zID0gcmVzcG9uc2UucmVzdWx0CiAgICAgICAgbGV0IGFsbElkcyA9IFtdCiAgICAgICAgbG9jYXRpb25BdXRvcy5tYXAoYXV0byA9PiB7CiAgICAgICAgICBpZihhdXRvLnN0YXR1cyAhPSAnZGVsZXRlZCcpIHsKICAgICAgICAgICAgaWYodHlwZW9mIGF1dG8uaWRlbnRpZmllciAhPSAnc3RyaW5nJykgewogICAgICAgICAgICAgIGFsbElkcy5wdXNoKEpTT04uc3RyaW5naWZ5KGF1dG8uaWRlbnRpZmllcikpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGFsbElkcy5wdXNoKGF1dG8uaWRlbnRpZmllcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHZtLmR1cGxpY2F0ZUlkID0gYWxsSWRzLmluY2x1ZGVzKGlkKTsKICAgICAgfSkKICAgIH0sCiAgICBzYXZlQXV0b21hdGlvbigpIHsKICAgICAgRXZlbnRTZXJ2aWNlLiRlbWl0KCJsb2FkaW5nIiwgInNob3ciKTsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgaWYodm0ucGFnZUFjdGlvbiA9PSAnQWRkIE5ldycpIHsKICAgICAgICBBdXRvbWF0aW9uU2VydmljZS5zYXZlQXV0b21hdGlvbih2bS5hdXRvbWF0aW9uKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgRXZlbnRTZXJ2aWNlLiRlbWl0KCJsb2FkaW5nIiwgImhpZGUiKTsKICAgICAgICAgICAgRXZlbnRTZXJ2aWNlLiRlbWl0KAogICAgICAgICAgICAgICJzdWNjZXNzTWVzc2FnZSIsCiAgICAgICAgICAgICAgIkhvb3JheSEgQXV0b21hdGlvbiBTYXZlZC4iCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZtLmNsb3NlTW9kYWwoJ1NhdmVkJyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBFdmVudFNlcnZpY2UuJGVtaXQoImxvYWRpbmciLCAiaGlkZSIpOwogICAgICAgICAgICBFdmVudFNlcnZpY2UuJGVtaXQoCiAgICAgICAgICAgICAgImVycm9yTWVzc2FnZSIsCiAgICAgICAgICAgICAgIlNvcnJ5LCBzb21ldGhpbmcgd2VudCB3cm9uZy4gUGxlYXNlIHRyeSBhZ2Fpbi4iCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSBlbHNlIHsKICAgICAgICBBdXRvbWF0aW9uU2VydmljZS51cGRhdGVBdXRvbWF0aW9uKHZtLmF1dG9tYXRpb24pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcykgewogICAgICAgICAgICBFdmVudFNlcnZpY2UuJGVtaXQoImxvYWRpbmciLCAiaGlkZSIpOwogICAgICAgICAgICBFdmVudFNlcnZpY2UuJGVtaXQoCiAgICAgICAgICAgICAgInN1Y2Nlc3NNZXNzYWdlIiwKICAgICAgICAgICAgICAiSG9vcmF5ISBBdXRvbWF0aW9uIFNhdmVkLiIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdm0uY2xvc2VNb2RhbCgnU2F2ZWQnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEV2ZW50U2VydmljZS4kZW1pdCgibG9hZGluZyIsICJoaWRlIik7CiAgICAgICAgICAgIEV2ZW50U2VydmljZS4kZW1pdCgKICAgICAgICAgICAgICAiZXJyb3JNZXNzYWdlIiwKICAgICAgICAgICAgICAiU29ycnksIHNvbWV0aGluZyB3ZW50IHdyb25nLiBQbGVhc2UgdHJ5IGFnYWluLiIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CiAgICB9LAogICAgc3BsaXRBbmRDb252ZXJ0TmFtZShkYXRhKSB7CiAgICAgIHJldHVybiAoZGF0YS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGRhdGEuc3Vic3RyKDEpKS5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKS50cmltKCk7CiAgICB9LAoKICAgIC8vIExvZ2ljIGJlbG93IGFsbG93aW5nIGFuIGFjdGlvbiB0byBjb250YWluIGEgbmV3IHNtcyBtZXNzYWdlLCBhZGp1c3QgdGhlID4gNyBpbiBvcmRlciB0byBjaGFuZ2UgdGltZSBmcmFtZSBkaWZmZXJlbmNlIHRvIGFsbG93IG1vcmUgb3IgbGVzcyB0aW1lIHRvIHBhc3MgYmV0d2VlbiB0ZXh0cy4KCiAgICBjaGVja1RpbWUodGltZSwgaW5kZXgpIHsKICAgICAgbGV0IG5ld0FycmF5ID0gW107CiAgICAgIHRoaXMuYXV0b21hdGlvbi5hY3Rpb25zLm1hcChlID0+IHsKICAgICAgICBuZXdBcnJheS5wdXNoKGUudGltZSk7CiAgICAgIH0pCiAgICAgIGxldCBuZXdUaW1lcyA9IG5ld0FycmF5LnNvcnQoICggYSwgYiApID0+IGEgLSBiICk7CiAgICAgIGlmKGluZGV4ID09IDApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChpbmRleCA+IDAgJiYgdGltZSA9PSAwKXsKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfSBlbHNlIHsKICAgICAgICBpZihuZXdUaW1lcy5pbmRleE9mKHRpbWUpID4gMCkgewogICAgICAgICAgaWYoTWF0aC5hYnModGltZSAtIG5ld1RpbWVzW25ld1RpbWVzLmluZGV4T2YodGltZSktMV0pID4gNykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNoZWNrTWluVGltZXMoYWN0aW9uKXsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgbGV0IGluZGV4ID0gdm0uc2VsZWN0ZWRJbmRleDsKICAgICAgaWYoaW5kZXggPT0gMCApIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdm0uYXV0b21hdGlvbi5hY3Rpb25zW2luZGV4LTFdLnRpbWU7CiAgICAgIH0KICAgIH0sCiAgICBhZGRBY3Rpb24obG9jYXRpb24sIGluZGV4KSB7CiAgICAgIGlmICh0aGlzLmF1dG9tYXRpb25UeXBlID09ICJyZXZpZXdSZXF1ZXN0IikgewogICAgICAgIHZhciBuZXdBY3Rpb24gPSB7CiAgICAgICAgICB0aW1lOiAwLAogICAgICAgICAgZW1haWw6IHsKICAgICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgICBzdWJqZWN0OiAiIiwKICAgICAgICAgICAgZGVzaWduOiB7CiAgICAgICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICAgICAgZGVzaWduOiAiIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgc21zOiB7CiAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICAgICAgcHJldmlldzogIiIsCiAgICAgICAgICAgIG1lc3NhZ2U6ICIiCiAgICAgICAgICB9LAogICAgICAgICAgbm90aWNlOiB7CiAgICAgICAgICAgIHBvdGVudGlhbE5lZ1JldjogdHJ1ZSwKICAgICAgICAgICAgYWN0dWFsTmVnUmV2OiB0cnVlLAogICAgICAgICAgICBwb3NpdGl2ZVJldjogdHJ1ZSwKICAgICAgICAgICAgcHJpdmF0ZVJldjogdHJ1ZQogICAgICAgICAgfSwKCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmF1dG9tYXRpb25UeXBlID09ICJzdXJ2ZXkiKSB7CiAgICAgICAgdmFyIG5ld0FjdGlvbiA9IHsKICAgICAgICAgIHRpbWU6IDAsCiAgICAgICAgICBlbWFpbDogewogICAgICAgICAgICBhY3RpdmU6IHRydWUsCiAgICAgICAgICAgIHN1YmplY3Q6ICIiLAogICAgICAgICAgICBkZXNpZ246IHsKICAgICAgICAgICAgICBkYXRhOiAiIiwKICAgICAgICAgICAgICBkZXNpZ246ICIiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBzbXM6IHsKICAgICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgICBwcmV2aWV3OiAiIiwKICAgICAgICAgICAgbWVzc2FnZTogIiIKICAgICAgICAgIH0sCiAgICAgICAgICBzdXJ2ZXlRdWVzdGlvbnM6IFtdCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmF1dG9tYXRpb250eXBlID09ICJsb3lhbHR5IikgewogICAgICAgIHZhciBuZXdBY3Rpb24gPSB7CiAgICAgICAgICB0aW1lOiAwLAogICAgICAgICAgZW1haWw6IHsKICAgICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgICBzdWJqZWN0OiAiIiwKICAgICAgICAgICAgZGVzaWduOiB7CiAgICAgICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICAgICAgZGVzaWduOiAiIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgc21zOiB7CiAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICAgICAgcHJldmlldzogIiIsCiAgICAgICAgICAgIG1lc3NhZ2U6ICIiCiAgICAgICAgICB9LAogICAgICAgICAgbG95YWx0eUNvdXBvbjogewogICAgICAgICAgICBpbWFnZTogJycsCiAgICAgICAgICAgIGltYWdlVHlwZTogJycKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBuZXdBY3Rpb24gPSB7CiAgICAgICAgICB0aW1lOiAwLAogICAgICAgICAgZW1haWw6IHsKICAgICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgICBzdWJqZWN0OiAiIiwKICAgICAgICAgICAgZGVzaWduOiB7CiAgICAgICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICAgICAgZGVzaWduOiAiIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgc21zOiB7CiAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICAgICAgcHJldmlldzogIiIsCiAgICAgICAgICAgIG1lc3NhZ2U6ICIiCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgICBpZiAobG9jYXRpb24gPT0gImJlbG93IikgewogICAgICAgIHRoaXMuYXV0b21hdGlvbi5hY3Rpb25zLnNwbGljZShpbmRleCArIDEsIDAsIG5ld0FjdGlvbik7CiAgICAgIH0gZWxzZSBpZiAobG9jYXRpb24gPT0gImFib3ZlIikgewogICAgICAgIHRoaXMuYXV0b21hdGlvbi5hY3Rpb25zLnNwbGljZShpbmRleCwgMCwgbmV3QWN0aW9uKTsKICAgICAgfQogICAgfSwKICAgIGFkZExhbmRpbmdQYWdlRGF0YSgpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgbGV0IHNlbGVjdGVkTG9jYXRpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9jYXRpb25JZCcpOwogICAgICBsZXQgbG9jT3B0aW9ucyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvY2F0aW9uT3B0aW9ucycpKTsKICAgICAgbG9jT3B0aW9ucy5tYXAobG9jID0+IHsKICAgICAgICBpZihsb2MubG9jYXRpb25JZCA9PSBzZWxlY3RlZExvY2F0aW9uKSB7CiAgICAgICAgICBsZXQgbWF0Y2hlZExvY2F0aW9uID0gbG9jOwogICAgICAgICAgdm0uYXV0b21hdGlvbkxvY2F0aW9uTmFtZSA9IGxvYy5kaXNwbGF5TmFtZTsKICAgICAgICB9OwogICAgICB9KQogICAgfSwKICAgIGFkZFN1cnZleURhdGEoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGlmICh2bS5hdXRvbWF0aW9uVHlwZSA9PSAic3VydmV5IikgewogICAgICAgIHZtLmF1dG9tYXRpb24uYWN0aW9uc1swXS5zdXJ2ZXlRdWVzdGlvbnMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIGFkZExveWFsdHlDb3Vwb24oKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGlmKHZtLmF1dG9tYXRpb25UeXBlID09ICdsb3lhbHR5JykgewogICAgICAgIHZtLmF1dG9tYXRpb24uYWN0aW9uc1swXS5sb3lhbHR5Q291cG9uID0gewogICAgICAgICAgaW1hZ2U6ICcnLAogICAgICAgICAgaW1hZ2VUeXBlOiAnJywKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICByZW1vdmVBY3Rpb24oaW5kZXgpIHsKICAgICAgdGhpcy5hdXRvbWF0aW9uLmFjdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCgogICAgcHJldmlld0VtYWlsKGFjdGlvbikgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICAvLyBSZW1vdmVzIGFueSBvdGhlciBlZGl0aW5nIHNvIHRoYXQgb3RoZXIgZW1haWwgcHJldmlld3MgZG9uJ3QgaW50ZXJmZXJlLgogICAgICB2bS5jbG9zZUFsbEVkaXRpbmcoKTsKICAgICAgdm0uc2VsZWN0ZWRBY3Rpb24gPSBhY3Rpb247CiAgICAgIHZtLmVtYWlsUHJldmlldyA9IHRydWU7CiAgICAgIC8vIHZtLnNwaW5uZXJBY3RpdmUgPSB0cnVlOwogICAgICAvLyBDaGVja3MgZm9yIHByb3BlciBpbmZvcm1hdGlvbiBpbiBvcmRlciB0byBwYXNzIGNvcnJlY3QgZGF0YSB0byBtYWlsY2hpbXAgZm9yIHRlc3RpbmcuCiAgICAgIGlmIChjb25maWcuc3ViRG9tYWluKSB7CiAgICAgICAgdmFyIHN1YkRvbWFpbiA9IGNvbmZpZy5zdWJEb21haW47CiAgICAgIH0KICAgICAgaWYgKGNvbmZpZy5iYXNlVXJsKSB7CiAgICAgICAgdmFyIGJhc2VVcmwgPSBjb25maWcuYmFzZVVybDsKICAgICAgfQogICAgICAvLyBUaW1lb3V0IGlzIHNldCB0byBiZSBtYW5pcHVsYXRlZCBpZiB3ZSBuZWVkIG1vcmUgdGltZSBsYXRlciBpbiBhIHNpbmdsZSB2YXJpYWJsZS4KICAgICAgdmFyIHRpbWVPdXQgPSAyMDA7CiAgICAgIC8vIENoZWNrIGlmIHRoZSBhY3Rpb24gcGFzc2VkIGludG8gdGhlIGZ1bmN0aW9uIGFscmVhZHkgaGFzIGJlZW4gc2F2ZWQsIHNvIHRoYXQgaXQgaXMgbm90IG92ZXJ3cml0dGVuIGlmIGl0IGlzLgogICAgICBpZiAodm0uY2FtcGFpZ24uZW1haWxEZXRhaWxzLmRlc2lnbi5kZXNpZ24pIHsKICAgICAgICAvLyBDcmVhdGUgdGhlIHNjcmlwdCBhbmQgaWZyYW1lIHRvIGJlIHVzZWQgdG8gZWRpdCB0aGUgZW1haWwuCiAgICAgICAgdm0uJHVubGF5ZXJTY3JpcHQgPSB7CiAgICAgICAgICBpZDogImVtYWlsLWVkaXRvciIsCiAgICAgICAgICBwcm9qZWN0SWQ6IDE3NzcsCiAgICAgICAgICBkaXNwbGF5TW9kZTogImVtYWlsIgogICAgICAgIH07CgogICAgICAgIHZhciBkID0gZG9jdW1lbnQ7CiAgICAgICAgdmFyIHMgPSBkLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHMudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICAgIHMuZGVmZXIgPSB0cnVlOwogICAgICAgIHMuc3JjID0gIi8vZWRpdG9yLnVubGF5ZXIuY29tL2VtYmVkLmpzIjsKICAgICAgICB2YXIgdCA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpWzBdOwogICAgICAgIHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocywgdCk7CiAgICAgICAgLy8gQWN0dWFsbHkgbG9hZCB0aGUgZXhpc3RpbmcgZGVzaWduIGluIHRoZSBhY3Rpb24sIGNoZWNrIGZvciBpbml0aWFsaXplZFVubGF5ZXIgZXhpc3RzIGFzIGZhaWxzYWZlIGZvciB0aGUgaWZyYW1lIG5vdCBiZWluZyByZXNldCBwcm9wZXJseS4KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGlmICghdm0uaW5pdGlhbGl6ZWRVbmxheWVyKSB7CiAgICAgICAgICAgIHVubGF5ZXIuaW5pdCh2bS4kdW5sYXllclNjcmlwdCk7CiAgICAgICAgICAgIHZtLmluaXRpYWxpemVkVW5sYXllciA9IHRydWU7CiAgICAgICAgICAgIHVubGF5ZXIubG9hZERlc2lnbih2bS5jYW1wYWlnbi5lbWFpbERldGFpbHMuZGVzaWduLmRlc2lnbik7CiAgICAgICAgICB9CiAgICAgICAgfSwgdGltZU91dCk7CiAgICAgICAgLy8gdm0uc3Bpbm5lckFjdGl2ZSA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIElmIGVtYWlsIGRlc2lnbiBkb2Vzbid0IGV4aXN0IGZvciB0aGUgc2VsZWN0ZWQgYWN0aW9uLCBjcmVhdGUgYWxsIG5lY2Vzc2FyeSBmaWVsZHMgdG8gcGFzcyBhcyBkZXNpZ25UYWdzIGFuZCBzZXQgdGhlIGluaXRpYWwgZGVzaWduLgogICAgICAgIExvY2F0aW9uU2VydmljZS5nZXRMb2NhdGlvbih2bS5jYW1wYWlnbi5sb2NhdGlvbklkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kaXNwbGF5TmFtZSkgewogICAgICAgICAgICB2bS5hdXRvbWF0aW9uTG9jYXRpb25OYW1lID0gcmVzcG9uc2UuZGlzcGxheU5hbWU7CiAgICAgICAgICAgIHZtLmFkZExhbmRpbmdQYWdlRGF0YSgpOwogICAgICAgICAgICB2YXIgbG9jYXRpb25OYW1lID0gcmVzcG9uc2UuZGlzcGxheU5hbWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbG9jYXRpb25OYW1lID0gcmVzcG9uc2UubmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzdHlsZSA9IHJlc3BvbnNlLmxvY2F0aW9uU3R5bGU7CiAgICAgICAgICB2YXIgbG9nbyA9IHN0eWxlLmxvZ287CiAgICAgICAgICB2YXIgY29sb3JzID0gc3R5bGUuYnV0dG9uQ29sb3IgfHwgIiM0ZmNiYzUiOwogICAgICAgICAgdmFyIGJ1dHRvbkNvbG9ycyA9IHZtLmdlbmVyYXRlQnV0dG9uQ29sb3JzKGNvbG9ycyk7CiAgICAgICAgICB2YXIgYXV0b21hdGlvbklkID0gJ0FVJyArIHZtLmdlbmVyYXRlQXV0b0lkKCcwJywgMTEpOwogICAgICAgICAgdm0uYXV0b21hdGlvbi5hdXRvbWF0aW9uSWQgPSBhdXRvbWF0aW9uSWQ7CgogICAgICAgICAgdm0uJHVubGF5ZXJTY3JpcHQgPSB7CiAgICAgICAgICAgIGlkOiAiZW1haWwtZWRpdG9yIiwKICAgICAgICAgICAgcHJvamVjdElkOiAxNzc3LAogICAgICAgICAgICBkaXNwbGF5TW9kZTogImVtYWlsIiwKICAgICAgICAgICAgZGVzaWduVGFnczogewogICAgICAgICAgICAgIGxvY2F0aW9uX25hbWU6IGxvY2F0aW9uTmFtZSwKICAgICAgICAgICAgICAvLyBVcGRhdGUgd2hlbiBhdXRvbWF0aW9uIGlkZW50aWZpZXIgaXMgY3JlYXRlZC4KICAgICAgICAgICAgICAvLyB0ZW1wbGF0ZV9pZDogdm0uYXV0b21hdGlvbi5uYW1lLAogICAgICAgICAgICAgIHJldmlld191cmw6ICJodHRwczovLyIgKyBzdWJEb21haW4gKyAiLm9waW5paW9uLmNvbS9hdXRvbWF0aW9uUmV2aWV3RW1haWwvIiArIHZtLmxvY2F0aW9uSWQgKyAnLycgKyBhdXRvbWF0aW9uSWQrICc6JyArICcqfGFpZHwqLyp8Y2lkfConLAogICAgICAgICAgICAgIGRpc3BsYXlfdXJsOiAiaHR0cHM6Ly8iICsgc3ViRG9tYWluICsgIi5vcGluaWlvbi5jb20vbGVhdmVGZWVkYmFjay8iICsgdm0ubG9jYXRpb25JZCArICcvKnxjaWR8Ki9FbWFpbCcsCiAgICAgICAgICAgICAgdW5zdWJzY3JpYmVfdXJsOiAiaHR0cHM6Ly8iICsgc3ViRG9tYWluICsgIi5vcGluaWlvbi5jb20vdW5zdWJzY3JpYmU/Y2lkPSp8Y2lkfCoiLAogICAgICAgICAgICAgIGltYWdlX3VybDogYmFzZVVybCArIGBsb2NhdGlvblwvc2hvd0ltYWdlXC9gICsgdm0ubG9jYXRpb25JZCwKICAgICAgICAgICAgICBzdXJ2ZXlfdXJsOiBiYXNlVXJsICsgJ3N1cnZleVJlc3BvbnNlLycsCiAgICAgICAgICAgICAgYnV0dG9uX2NvbG9yXzA6IGJ1dHRvbkNvbG9yc1swXSwKICAgICAgICAgICAgICBidXR0b25fY29sb3JfMTogYnV0dG9uQ29sb3JzWzFdLAogICAgICAgICAgICAgIGJ1dHRvbl9jb2xvcl8yOiBidXR0b25Db2xvcnNbMl0sCiAgICAgICAgICAgICAgYnV0dG9uX2NvbG9yXzM6IGJ1dHRvbkNvbG9yc1szXSwKICAgICAgICAgICAgICBidXR0b25fY29sb3JfNDogYnV0dG9uQ29sb3JzWzRdLAogICAgICAgICAgICAgIGZvb3Rlcl9jb2xvcjogc3R5bGUuZm9vdGVyQ29sb3IgfHwgImxpZ2h0Z3JleSIKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAodm0uYXV0b21hdGlvblR5cGUgPT0gImNhbXBhaWduIikgewogICAgICAgICAgICB2bS4kdW5sYXllclNjcmlwdC50ZW1wbGF0ZUlkID0gNDk3NzsKICAgICAgICAgIH0gZWxzZSBpZiAodm0uYXV0b21hdGlvblR5cGUgPT0gInN1cnZleSIpIHsKICAgICAgICAgICAgdm0uJHVubGF5ZXJTY3JpcHQudGVtcGxhdGVJZCA9IDQ5NzY7CiAgICAgICAgICB9IGVsc2UgaWYgKHZtLmF1dG9tYXRpb25UeXBlID09ICJsb3lhbHR5IikgewogICAgICAgICAgICB2bS4kdW5sYXllclNjcmlwdC50ZW1wbGF0ZUlkID0gNTI4NDsKICAgICAgICAgIH0gZWxzZSBpZiAodm0uYXV0b21hdGlvblR5cGUgPT0gInJldmlld1JlcXVlc3QiKSB7CiAgICAgICAgICAgIHZtLiR1bmxheWVyU2NyaXB0LnRlbXBsYXRlSWQgPSA1MzA3OwogICAgICAgICAgICBpZiAodm0udGVtcGxhdGVUeXBlID09ICJzdGFuZGFyZCIgfHwgIXZtLnRlbXBsYXRlVHlwZSkgewogICAgICAgICAgICAgIHZtLiR1bmxheWVyU2NyaXB0LmRlc2lnblRhZ3MubWVzc2FnZV9ibG9jayA9CiAgICAgICAgICAgICAgICAiVGhhbmsgeW91IHNvIG11Y2ggZm9yIGNob29zaW5nICIgKwogICAgICAgICAgICAgICAgbG9jYXRpb25OYW1lICsKICAgICAgICAgICAgICAgICIhIFlvdXIgc2F0aXNmYWN0aW9uIGlzIG91ciB0b3AgcHJpb3JpdHksIGFuZCB3ZSdkIGxvdmUgdG8gaGVhciBmcm9tIHlvdS4gUGxlYXNlIHRha2UgYSBmZXcgc2Vjb25kcyB0byBsZXQgdXMga25vdyBob3cgd2UncmUgZG9pbmcuIjsKICAgICAgICAgICAgfSBlbHNlIGlmICh2bS50ZW1wbGF0ZVR5cGUgPT0gInByb3BlcnR5IikgewogICAgICAgICAgICAgIHZtLiR1bmxheWVyU2NyaXB0LmRlc2lnblRhZ3MubWVzc2FnZV9ibG9jayA9CiAgICAgICAgICAgICAgICAiVGhhbmtzIGZvciBqb2luaW5nIHVzISBZb3VyIHNhdGlzZmFjdGlvbiBpcyBvdXIgdG9wIHByaW9yaXR5LCBhbmQgd2UnZCBsb3ZlIHRvIGhlYXIgZnJvbSB5b3UuIFBsZWFzZSB0YWtlIGEgZmV3IHNlY29uZHMgdG8gcmF0ZSB5b3VyIGV4cGVyaWVuY2UuIjsKICAgICAgICAgICAgfSBlbHNlIGlmICh2bS50ZW1wbGF0ZVR5cGUgPT0gInNlcnZpY2UiKSB7CiAgICAgICAgICAgICAgdm0uJHVubGF5ZXJTY3JpcHQuZGVzaWduVGFncy5tZXNzYWdlX2Jsb2NrID0KICAgICAgICAgICAgICAgICJUaGFuayB5b3Ugc28gbXVjaCBmb3IgY2hvb3NpbmcgIiArCiAgICAgICAgICAgICAgICBsb2NhdGlvbk5hbWUgKwogICAgICAgICAgICAgICAgIiEgWW91ciBzYXRpc2ZhY3Rpb24gaXMgb3VyIHRvcCBwcmlvcml0eSwgYW5kIHdlJ2QgbG92ZSB0byBoZWFyIGZyb20geW91LiBQbGVhc2UgdGFrZSBhIGZldyBzZWNvbmRzIHRvIGxldCB1cyBrbm93IGhvdyB3ZSdyZSBkb2luZy4iOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZtLiR1bmxheWVyU2NyaXB0LmRlc2lnblRhZ3MubWVzc2FnZV9ibG9jayA9CiAgICAgICAgICAgICAgICAiVGhhbmsgeW91IHNvIG11Y2ggZm9yIGNob29zaW5nICIgKwogICAgICAgICAgICAgICAgbG9jYXRpb25OYW1lICsKICAgICAgICAgICAgICAgICIhIFlvdXIgc2F0aXNmYWN0aW9uIGlzIG91ciB0b3AgcHJpb3JpdHksIGFuZCB3ZSdkIGxvdmUgdG8gaGVhciBmcm9tIHlvdS4gUGxlYXNlIHRha2UgYSBmZXcgc2Vjb25kcyB0byBsZXQgdXMga25vdyBob3cgd2UncmUgZG9pbmcuIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkID0gZG9jdW1lbnQ7CiAgICAgICAgICB2YXIgcyA9IGQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgICBzLnR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IjsKICAgICAgICAgIHMuZGVmZXIgPSB0cnVlOwogICAgICAgICAgcy5zcmMgPSAiLy9lZGl0b3IudW5sYXllci5jb20vZW1iZWQuanMiOwogICAgICAgICAgdmFyIHQgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKVswXTsKICAgICAgICAgIHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocywgdCk7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWYgKCF2bS5pbml0aWFsaXplZFVubGF5ZXIpIHsKICAgICAgICAgICAgICB2bS5pbml0aWFsaXplZFVubGF5ZXIgPSB0cnVlOwogICAgICAgICAgICAgIHVubGF5ZXIuaW5pdCh2bS4kdW5sYXllclNjcmlwdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHRpbWVPdXQpOwogICAgICAgIC8vIHZtLnNwaW5uZXJBY3RpdmUgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIHNhdmVFbWFpbERlc2lnbigpIHsKICAgIC8vICAgbGV0IHZtID0gdGhpczsKICAgIC8vICAgaWYgKHZtLmluaXRpYWxpemVkVW5sYXllcikgewogICAgLy8gICAgIHVubGF5ZXIuZXhwb3J0SHRtbChmdW5jdGlvbihkYXRhKSB7CiAgICAvLyAgICAgICB2bS5zZWxlY3RlZEFjdGlvbi5lbWFpbC5kZXNpZ24gPSB7CiAgICAvLyAgICAgICAgIGRhdGE6IGRhdGEuaHRtbCwKICAgIC8vICAgICAgICAgZGVzaWduOiBkYXRhLmRlc2lnbgogICAgLy8gICAgICAgfTsKICAgIC8vICAgICAgIHZtLnJlbW92ZUlmcmFtZSgpOwogICAgLy8gICAgIH0pOwogICAgLy8gICB9CiAgICAvLyAgIC8vIGNvbnNvbGUubG9nKHZtLnNlbGVjdGVkQWN0aW9uLmVtYWlsKTsKICAgIC8vIH0sCiAgICBwcmV2aWV3U01TKGFjdGlvbiwgaSkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICB2bS5zZWxlY3RlZEFjdGlvbiA9IGFjdGlvbjsKICAgICAgdm0udGVtcE1lc3NhZ2UgPSBhY3Rpb24uc21zLm1lc3NhZ2U7CiAgICAgIC8vIEFkZCBsb2dpYyBmb3Igb3BlbmluZyBvbmx5IGlmIGluZGV4ID09IDAgb3IgZGlzcGxheSBhZ3JlZW1lbnQuCiAgICAgIC8vIGlmKCjCoGkgPT0gMCAmJiB2bS5hdXRvbWF0aW9uLmFjdGlvbnMubGVuZ3RoICYmIHZtLmF1dG9tYXRpb24uYWN0aW9ucy5sZW5ndGggPT0gMSkgfHwgdm0uYWdyZWVtZW50KSB7CiAgICAgIHZtLmNsb3NlQWxsRWRpdGluZygpOwogICAgICB2bS5zbXNQcmV2aWV3ID0gdHJ1ZTsKICAgICAgLy8gfSBlbHNlIHsKICAgICAgLy8gICB2bS50Y3BhQ29tcGxpYW5jZU9wZW4gPSB0cnVlOwogICAgICAvLyB9CiAgICB9LAogICAgY2hhbmdlQWdyZWVtZW50KCkgewogICAgICB0aGlzLmFncmVlbWVudCA9IHRydWU7CiAgICAgIC8vIEFjdGl2YXRlIHRoaXMgbGluZSBvZiBjb2RlIG9uY2UgYmFjayBlbmQgaXMgcHVzaGVkLgogICAgICBMb2NhdGlvblNlcnZpY2Uuc2V0VENQQUFncmVlbWVudCh0aGlzLmxvY2F0aW9uSWQsIHRoaXMudXNlckRhdGEpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICB9KQogICAgICB0aGlzLnRjcGFDb21wbGlhbmNlT3BlbiA9IGZhbHNlOwogICAgICB0aGlzLnByZXZpZXdTTVModGhpcy5zZWxlY3RlZEFjdGlvbik7CiAgICB9LAogICAgY2FuY2VsU01TKCkgewogICAgICB0aGlzLnRjcGFDb21wbGlhbmNlT3BlbiA9IGZhbHNlOwogICAgICB0aGlzLnRlbXBNZXNzYWdlID0gJyc7CiAgICAgIHRoaXMuc21zUHJldmlldyA9IGZhbHNlOwogICAgfSwKICAgIGdlbmVyYXRlQXV0b0lkKHBvc3NJdGVtcywgbGVuZ3RoKSB7CiAgICAgIHZhciB0ZXh0ID0gJyc7CiAgICAgIHZhciBvcHRpb25zID0gJyc7CiAgICAgIGlmIChwb3NzSXRlbXMuaW5kZXhPZignMCcpID4gLTEpIG9wdGlvbnMgKz0gJzAxMjM0NTY3ODknOwogICAgICBpZiAocG9zc0l0ZW1zLmluZGV4T2YoJ2EnKSA+IC0xKSBvcHRpb25zICs9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eic7CiAgICAgIGlmIChwb3NzSXRlbXMuaW5kZXhPZignQScpID4gLTEpIG9wdGlvbnMgKz0gJ0FCQ0RFRkdISWtMTU5PUFFSU1RVVldYWVonOwogICAgICBmb3IgKHZhciBpPTA7IGk8bGVuZ3RoICYmIG9wdGlvbnMubGVuZ3RoPjA7IGkrKykgewogICAgICAgIHRleHQgKz0gb3B0aW9ucy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogb3B0aW9ucy5sZW5ndGgpKTsKICAgICAgfQogICAgICByZXR1cm4gdGV4dDsKICAgIH0sCiAgICBlZGl0VGltZUNvbmRpdGlvbihhY3Rpb24sIGluZGV4KSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHZtLmNsb3NlQWxsRWRpdGluZygpOwogICAgICB2bS5zZWxlY3RlZEFjdGlvbiA9IGFjdGlvbjsKICAgICAgdm0uc2VsZWN0ZWRJbmRleCA9IGluZGV4OwogICAgICB2bS5lZGl0aW5nVGltZUNvbmRpdGlvbiA9IHRydWU7CiAgICB9LAogICAgZWRpdExhbmRpbmdQYWdlKGFjdGlvbikgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICB2bS5jbG9zZUFsbEVkaXRpbmcoKTsKICAgICAgdm0uZWRpdGluZ0xhbmRpbmdQYWdlID0gdHJ1ZTsKICAgICAgLy8gaWYoYWN0aW9uLmVtYWlsLnN1YmplY3QpIHsKICAgICAgLy8gICB2bS5jbG9zZUFsbEVkaXRpbmcoKTsKICAgICAgLy8gICB2bS5zZWxlY3RlZEFjdGlvbiA9IGFjdGlvbjsKICAgICAgLy8gICB2bS5lZGl0aW5nTGFuZGluZ1BhZ2UgPSB0cnVlOwogICAgICAvLyAgIHZtLmxhbmRpbmdNZXNzYWdlID0gJ0VkaXQgTGFuZGluZyBQYWdlIERldGFpbHMnCiAgICAgIC8vIH0gZWxzZSB7CiAgICAgIC8vICAgdm0ubGFuZGluZ01lc3NhZ2UgPSAnUGxlYXNlIGNyZWF0ZSBhbiBlbWFpbCBiZWZvcmUgZGVzaWduaW5nIHRoZSBsYW5kaW5nIHBhZ2UuJwogICAgICAvLyB9CiAgICB9LAogICAgZWRpdFN1cnZleShhY3Rpb24pIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgdm0uY2xvc2VBbGxFZGl0aW5nKCk7CiAgICAgIHZtLnNlbGVjdGVkQWN0aW9uID0gYWN0aW9uOwogICAgICB2bS5lZGl0aW5nU3VydmV5ID0gdHJ1ZTsKICAgIH0sCiAgICBlZGl0TG95YWx0eUNvdXBvbihhY3Rpb24pIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgdm0uY2xvc2VBbGxFZGl0aW5nKCk7CiAgICAgIHZtLnNlbGVjdGVkQWN0aW9uID0gYWN0aW9uOwogICAgICB2bS5hZGRpbmdMb3lhbHR5Q291cG9uID0gdHJ1ZTsKICAgIH0sCiAgICBvcGVuUHJldmlld01vZGFsKCkgewogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmxhbmRpbmdQYWdlKTsKICAgICAgdHJ5IHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXV0b21hdGlvblR5cGUnLCAncmV2aWV3UmVxdWVzdCcpOwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcmV2aWV3RGF0YScsIHRoaXMubGFuZGluZ1BhZ2UpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQogICAgICB9CiAgICAgIGxldCByb3V0ZSA9IHRoaXMuJHJvdXRlci5yZXNvbHZlKHtuYW1lOiAnUHJldmlldyBMYW5kaW5nJ30pOwogICAgICB3aW5kb3cub3Blbihyb3V0ZS5ocmVmLCAnX2JsYW5rJyk7CiAgICB9LAogICAgc2F2ZVNNUygpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgdm0uc2VsZWN0ZWRBY3Rpb24uc21zLm1lc3NhZ2UgPSB2bS50ZW1wTWVzc2FnZTsKICAgICAgdm0uY2xvc2VBbGxFZGl0aW5nKCk7CiAgICB9LAogICAgY2xvc2VBbGxFZGl0aW5nKCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICB2bS5zYXZlRW1haWxEZXNpZ24oKTsKICAgICAgdm0uZW1haWxQcmV2aWV3ID0gZmFsc2U7CiAgICAgIHZtLnNtc1ByZXZpZXcgPSBmYWxzZTsKICAgICAgdm0uZWRpdGluZ1RpbWVDb25kaXRpb24gPSBmYWxzZTsKICAgICAgdm0uZWRpdGluZ0xhbmRpbmdQYWdlID0gZmFsc2U7CiAgICAgIHZtLmVkaXRpbmdTdXJ2ZXkgPSBmYWxzZTsKICAgICAgdm0uYWRkaW5nTG95YWx0eUNvdXBvbiA9IGZhbHNlOwogICAgICB2bS5zZWxlY3RlZEluZGV4ID0gbnVsbDsKICAgIH0sCiAgICBjYW5jZWxFbWFpbEVkaXQoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHZtLnJlbW92ZUlmcmFtZSgpOwogICAgICB2bS5lbWFpbFByZXZpZXcgPSBmYWxzZTsKICAgICAgdm0uc21zUHJldmlldyA9IGZhbHNlOwogICAgICB2bS5lZGl0aW5nVGltZUNvbmRpdGlvbiA9IGZhbHNlOwogICAgICB2bS5lZGl0aW5nTGFuZGluZ1BhZ2UgPSBmYWxzZTsKICAgICAgdm0uZWRpdGluZ1N1cnZleSA9IGZhbHNlOwogICAgICB2bS5hZGRpbmdMb3lhbHR5Q291cG9uID0gZmFsc2U7CiAgICB9LAogICAgcmVtb3ZlSWZyYW1lKCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBpZiAodm0uaW5pdGlhbGl6ZWRVbmxheWVyKSB7CiAgICAgICAgdmFyIHggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIilbMF07CiAgICAgICAgdmFyIGQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07CiAgICAgICAgaWYgKHgpIHsKICAgICAgICAgIHgucmVtb3ZlKCk7CiAgICAgICAgfQogICAgICAgIGlmIChkKSB7CiAgICAgICAgICBkLnJlbW92ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICB2bS5pbml0aWFsaXplZFVubGF5ZXIgPSBmYWxzZTsKICAgIH0sCiAgICBhZGRBbnN3ZXIocXVlc3Rpb24pIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgcXVlc3Rpb24uYW5zd2VyT3B0aW9ucy5wdXNoKHF1ZXN0aW9uLm5ld09wdGlvbik7CiAgICAgIHF1ZXN0aW9uLm5ld09wdGlvbiA9ICcnOwogICAgICB2bS5yZWZyZXNoUXVlc3Rpb25zKCk7CiAgICB9LAogICAgcmVtb3ZlQW5zd2VyKHF1ZXN0aW9uLCBhbnN3ZXIpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgcXVlc3Rpb24uYW5zd2VyT3B0aW9ucy5zcGxpY2UocXVlc3Rpb24uYW5zd2VyT3B0aW9ucy5pbmRleE9mKGFuc3dlciksIDEpOwogICAgICB2bS5yZWZyZXNoUXVlc3Rpb25zKCk7CiAgICB9LAogICAgY2xvc2VQcmV2aWV3TW9kYWwoKSB7CiAgICAgIHRoaXMub3BlblByZXZpZXdDYW1wYWlnbiA9IGZhbHNlOwogICAgfSwKICAgIGNoYW5nZVF1ZXN0aW9ucygpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgaWYgKHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVRlbXBsYXRlID09ICJub25lIikgewogICAgICAgIHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVF1ZXN0aW9ucyA9IFtdOwogICAgICB9IGVsc2UgaWYgKHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVRlbXBsYXRlID09ICIxIikgewogICAgICAgIHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVF1ZXN0aW9ucyA9IFsKICAgICAgICAgIHsgb3JkZXI6IDEsIHR5cGU6ICIxdG81IiwgZXhwbGFpbjogdHJ1ZSwgdGl0bGU6ICJXaXRoIDEgYmVpbmcgbG93ZXN0IGFuZCA1IGJlaW5nIGhpZ2hlc3Q6ICIsIHF1ZXN0aW9uOiAiSG93IHdvdWxkIHlvdSByYXRlIG91ciB3b3JrIGN1bHR1cmU/IiB9LAogICAgICAgICAgeyBvcmRlcjogMiwgdHlwZTogInNlbGVjdEFueSIsIGV4cGxhaW46IHRydWUsIHRpdGxlOiAiU2VsZWN0IEFsbCBUaGF0IEFwcGx5OiIsIHF1ZXN0aW9uOiAiV2hhdCBkbyB5b3UgZW5qb3kgbW9zdCBhYm91dCB3b3JraW5nIGhlcmU/IiwgYW5zd2VyT3B0aW9uczpbXSB9LAogICAgICAgICAgeyBvcmRlcjogMywgdHlwZTogInNlbGVjdEFueSIsIGV4cGxhaW46IHRydWUsIHRpdGxlOiAiU2VsZWN0IEFsbCBUaGF0IEFwcGx5OiIsIHF1ZXN0aW9uOiAiV2hhdCBkbyB5b3UgZW5qb3kgbGVhc3QgYWJvdXQgd29ya2luZyBoZXJlPyIsIGFuc3dlck9wdGlvbnM6W10gfSwKICAgICAgICBdOwogICAgICB9IGVsc2UgaWYgKHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVRlbXBsYXRlID09ICIyIikgewogICAgICAgIHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVF1ZXN0aW9ucyA9IFsKICAgICAgICAgIHsgb3JkZXI6IDEsIHR5cGU6ICIxdG81IiwgZXhwbGFpbjogdHJ1ZSwgdGl0bGU6ICJXaXRoIDEgYmVpbmcgbG93ZXN0IGFuZCA1IGJlaW5nIGhpZ2hlc3Q6ICIsIHF1ZXN0aW9uOiAiSG93IHdvdWxkIHlvdSByYXRlIG91ciBmYWNpbHRpZXM/IiB9LAogICAgICAgICAgeyBvcmRlcjogMiwgdHlwZTogInNlbGVjdEFueSIsIGV4cGxhaW46IHRydWUsIHRpdGxlOiAiU2VsZWN0IEFsbCBUaGF0IEFwcGx5OiIsIHF1ZXN0aW9uOiAiV2hhdCBkbyB5b3UgZW5qb3kgbW9zdCBhYm91dCBsaXZpbmcgaGVyZT8iLCBhbnN3ZXJPcHRpb25zOltdIH0sCiAgICAgICAgICB7IG9yZGVyOiAzLCB0eXBlOiAic2VsZWN0QW55IiwgZXhwbGFpbjogdHJ1ZSwgdGl0bGU6ICJTZWxlY3QgQWxsIFRoYXQgQXBwbHk6IiwgcXVlc3Rpb246ICJXaGF0IGRvIHlvdSBlbmpveSBsZWFzdCBhYm91dCBsaXZpbmcgaGVyZT8iLCBhbnN3ZXJPcHRpb25zOltdIH0sCiAgICAgICAgXTsKICAgICAgfSBlbHNlIGlmICh2bS5zZWxlY3RlZEFjdGlvbi5zdXJ2ZXlUZW1wbGF0ZSA9PSAiMyIpIHsKICAgICAgICB2bS5zZWxlY3RlZEFjdGlvbi5zdXJ2ZXlRdWVzdGlvbnMgPSBbCiAgICAgICAgICB7IG9yZGVyOiAxLCB0eXBlOiAiMXRvNSIsIGV4cGxhaW46IHRydWUsIHRpdGxlOiAiV2l0aCAxIGJlaW5nIGxvd2VzdCBhbmQgNSBiZWluZyBoaWdoZXN0OiAiLCBxdWVzdGlvbjogIkhvdyB3b3VsZCB5b3UgcmF0ZSBvdXIgc2VydmljZT8iIH0sCiAgICAgICAgICB7IG9yZGVyOiAyLCB0eXBlOiAic2VsZWN0QW55IiwgZXhwbGFpbjogdHJ1ZSwgdGl0bGU6ICJTZWxlY3QgQWxsIFRoYXQgQXBwbHk6IiwgcXVlc3Rpb246ICJXaGF0IGRvIHdlIGRvIHdlbGw/IiwgYW5zd2VyT3B0aW9uczpbXSB9LAogICAgICAgICAgeyBvcmRlcjogMywgdHlwZTogInNlbGVjdEFueSIsIGV4cGxhaW46IHRydWUsIHRpdGxlOiAiU2VsZWN0IEFsbCBUaGF0IEFwcGx5OiIsIHF1ZXN0aW9uOiAiV2hhdCBjb3VsZCB3ZSBpbXByb3ZlIG9uPyIsIGFuc3dlck9wdGlvbnM6W10gfSwKICAgICAgICBdOwogICAgICB9CiAgICB9LAogICAgZW5jb2RlSW1hZ2VGaWxlQXNVUkwoZXZlbnQpIHsKICAgICAgbGV0IGZpbGVzTGlzdCA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAocmVhZGVyLnJlc3VsdC5sZW5ndGggPiA1MDAwMDAgKiAxLjM2KSB7CiAgICAgICAgICB2bS5zaG93TG9nb1NpemVFcnJvciA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnNlbGVjdGVkQWN0aW9uLmxveWFsdHlDb3Vwb24uaW1hZ2UgPSByZWFkZXIucmVzdWx0OwogICAgICAgICAgbGV0IHNlbGVjdGlvbiA9IHJlYWRlci5yZXN1bHQuc3Vic3RyKDAsIDI1KTsKICAgICAgICAgIHZtLnNlbGVjdGVkQWN0aW9uLmxveWFsdHlDb3Vwb24uaW1hZ2VUeXBlID0gc2VsZWN0aW9uLnN1YnN0cigoc2VsZWN0aW9uLmluZGV4T2YoIi8iKSsxKSwgKHNlbGVjdGlvbi5pbmRleE9mKCc7JyktMSAtIHNlbGVjdGlvbi5pbmRleE9mKCIvIikpKTsKICAgICAgICAgIHZtLmFkZGluZ0xveWFsdHlDb3Vwb24gPSBmYWxzZTsKICAgICAgICAgIHZtLmFkZGluZ0xveWFsdHlDb3Vwb24gPSB0cnVlOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZXNMaXN0KTsKICAgIH0sCiAgICBhcHBlbmRJbWFnZUhlYWRlcihpbWdUZXh0KSB7CiAgICAgIGlmIChpbWdUZXh0KSB7CiAgICAgICAgcmV0dXJuIGltZ1RleHQ7CiAgICAgIH0KICAgIH0sCiAgICBnZW5lcmF0ZUJ1dHRvbkNvbG9ycyhpbml0aWFsQ29sb3IpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgcmV0dXJuIFsKICAgICAgICB2bS5saWdodGVuQ29sb3IoaW5pdGlhbENvbG9yLCA0MCksCiAgICAgICAgdm0ubGlnaHRlbkNvbG9yKGluaXRpYWxDb2xvciwgMzApLAogICAgICAgIHZtLmxpZ2h0ZW5Db2xvcihpbml0aWFsQ29sb3IsIDIwKSwKICAgICAgICB2bS5saWdodGVuQ29sb3IoaW5pdGlhbENvbG9yLCAxMCksCiAgICAgICAgaW5pdGlhbENvbG9yCiAgICAgIF07CiAgICB9LAogICAgbGlnaHRlbkNvbG9yKGluaXRpYWxDb2xvciwgYW10KSB7CiAgICAgIHZhciBjb2wgPSBpbml0aWFsQ29sb3Iuc2xpY2UoMSk7CgogICAgICB2YXIgbnVtID0gcGFyc2VJbnQoY29sLCAxNik7CgogICAgICB2YXIgciA9IChudW0gPj4gMTYpICsgYW10OwoKICAgICAgaWYgKHIgPiAyNTUpIHIgPSAyNTU7CiAgICAgIGVsc2UgaWYgKHIgPCAwKSByID0gMDsKCiAgICAgIHZhciBiID0gKChudW0gPj4gOCkgJiAweDAwZmYpICsgYW10OwoKICAgICAgaWYgKGIgPiAyNTUpIGIgPSAyNTU7CiAgICAgIGVsc2UgaWYgKGIgPCAwKSBiID0gMDsKCiAgICAgIHZhciBnID0gKG51bSAmIDB4MDAwMGZmKSArIGFtdDsKCiAgICAgIGlmIChnID4gMjU1KSBnID0gMjU1OwogICAgICBlbHNlIGlmIChnIDwgMCkgZyA9IDA7CgogICAgICByZXR1cm4gKAogICAgICAgICIjIiArCiAgICAgICAgU3RyaW5nKCIwMDAwMDAiICsgKGcgfCAoYiA8PCA4KSB8IChyIDw8IDE2KSkudG9TdHJpbmcoMTYpKS5zbGljZSgtNikKICAgICAgKTsKICAgIH0sCiAgICBhZGRTdXJ2ZXlRdWVzdGlvbigpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgbGV0IG5ld09yZGVyID0gdm0uc2VsZWN0ZWRBY3Rpb24uc3VydmV5UXVlc3Rpb25zLmxlbmd0aCArIDE7CiAgICAgIHZtLnNlbGVjdGVkQWN0aW9uLnN1cnZleVF1ZXN0aW9ucy5wdXNoKHsKICAgICAgICBvcmRlcjogbmV3T3JkZXIsCiAgICAgICAgdHlwZTogIiIsCiAgICAgICAgdGl0bGU6ICIiLAogICAgICAgIHF1ZXN0aW9uOiAiIgogICAgICB9KTsKICAgICAgdm0ucmVmcmVzaFF1ZXN0aW9ucygpOwogICAgfSwKICAgIHJlZnJlc2hRdWVzdGlvbnMoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHZtLmVkaXRpbmdTdXJ2ZXkgPSBmYWxzZTsKICAgICAgdm0uZWRpdGluZ1N1cnZleSA9IHRydWU7CiAgICB9LAogICAgcmVtb3ZlU3VydmV5UXVlc3Rpb24oaW5kZXgpIHsKICAgICAgdGhpcy5zZWxlY3RlZEFjdGlvbi5zdXJ2ZXlRdWVzdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy5yZWZyZXNoUXVlc3Rpb25zKCk7CiAgICB9LAogICAgZHJhZ1N0YXJ0KGV2ZW50KSB7CiAgICAgIHRoaXMuZHJhZ2dpbmcgPSB0cnVlOwogICAgICBsZXQgZHQgPSBldmVudC5kYXRhVHJhbnNmZXI7CiAgICAgIGR0LnNldERhdGEoInRleHQvcGxhaW4iLCBldmVudC50YXJnZXQuaWQpOwogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJkaXNhYmxlLW9uLWRyYWciKTsKICAgICAgdmFyIGk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBlbC5sZW5ndGg7IGkrKykgewogICAgICAgIGVsW2ldLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGRyYWdPdmVyKGV2ZW50KSB7CiAgICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gIm1vdmUiOwogICAgfSwKICAgIGRyb3BRdWVzdGlvbihldmVudCkgewogICAgICBsZXQgZHQgPSBldmVudC5kYXRhVHJhbnNmZXI7CiAgICAgIHZhciBkYXRhID0gZXZlbnQuZGF0YVRyYW5zZmVyLmdldERhdGEoInRleHQvcGxhaW4iKTsKICAgICAgdGhpcy5zdGFydFBvc2l0aW9uID0gZGF0YTsKICAgICAgdGhpcy5lbmRQb3NpdGlvbiA9IGV2ZW50LnRhcmdldC5pZDsKICAgIH0sCiAgICBkcmFnRW5kKGV2ZW50KSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGxldCBzdGFydCA9IHRoaXMuc3RhcnRQb3NpdGlvbjsKICAgICAgbGV0IGVuZCA9IHRoaXMuZW5kUG9zaXRpb247CiAgICAgIHZhciBuZXdBcnJheSA9IFtdOwogICAgICBpZiAoKHN0YXJ0ICYmIGVuZCkgJiYgc3RhcnQgIT0gZW5kKSB7CiAgICAgICAgdm0uc2VsZWN0ZWRBY3Rpb24uc3VydmV5UXVlc3Rpb25zLm1hcCgocXVlc3Rpb24sIGkpID0+IHsKICAgICAgICAgIGlmIChpID09IHN0YXJ0KSB7CiAgICAgICAgICAgIGkgPSBlbmQ7CiAgICAgICAgICAgIG5ld0FycmF5W2ldID0gcXVlc3Rpb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZW5kID4gc3RhcnQpIHsKICAgICAgICAgICAgICBpZiAoaSA+IHN0YXJ0ICYmIGkgPD0gZW5kKSB7CiAgICAgICAgICAgICAgICBpID0gaSAtIDE7CiAgICAgICAgICAgICAgICBuZXdBcnJheVtpXSA9IHF1ZXN0aW9uOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXdBcnJheVtpXSA9IHF1ZXN0aW9uOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbmQgPCBzdGFydCkgewogICAgICAgICAgICAgIGlmIChpIDwgc3RhcnQgJiYgaSA+PSBlbmQpIHsKICAgICAgICAgICAgICAgIGkgPSBpICsgMTsKICAgICAgICAgICAgICAgIG5ld0FycmF5W2ldID0gcXVlc3Rpb247CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5ld0FycmF5W2ldID0gcXVlc3Rpb247CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdm0uc2VsZWN0ZWRBY3Rpb24uc3VydmV5UXVlc3Rpb25zID0gbmV3QXJyYXk7CiAgICAgIH0KICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZGlzYWJsZS1vbi1kcmFnIik7CiAgICAgIHZhciBpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgZWwubGVuZ3RoOyBpKyspIHsKICAgICAgICBlbFtpXS5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICAgIHZtLmRyYWdnaW5nID0gZmFsc2U7CiAgICB9LAogICAgY2xvc2VNb2RhbChtc2cpIHsKICAgICAgaWYobXNnKSB7CiAgICAgICAgdGhpcy4kZW1pdCgiY2xvc2VNb2RhbCIpOwogICAgICAgIHRoaXMuYXV0b21hdGlvbiA9IHt9OwogICAgICAgIHRoaXMuc2VsZWN0ZWRBY3Rpb24gPSB7fTsKICAgICAgICBFdmVudFNlcnZpY2UuJGVtaXQoImxvYWRpbmciLCAiaGlkZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd291bGQgbGlrZSB0byBleGl0IHdpdGhvdXQgc2F2aW5nPycpKSB7CiAgICAgICAgdGhpcy4kZW1pdCgiY2xvc2VNb2RhbCIpOwogICAgICAgIHRoaXMuYXV0b21hdGlvbiA9IHt9OwogICAgICAgIHRoaXMuc2VsZWN0ZWRBY3Rpb24gPSB7fTsKICAgICAgICBFdmVudFNlcnZpY2UuJGVtaXQoImxvYWRpbmciLCAiaGlkZSIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["AddNewAutomation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6JA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AddNewAutomation.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <transition name=\"modal\">\n    <div class=\"modal-mask\" @click=\"closeModal()\">\n      <div class=\"automation-container\" @click.stop>\n        <header>\n          <span>{{pageAction}} {{displayName}}</span>\n          <i class=\"fal fa-times\" @click=\"closeModal()\"></i>\n        </header>\n        <div class=\"automations-style-container\">\n          <div class=\"main-display\" v-if=\"!editingLandingPage && !emailPreview && !smsPreview\">\n            <div class=\"automation-name\">\n              <span class=\"initial-trigger\"> Automation Name </span>\n              <input class=\"input-name\" type=\"text\" v-model=\"automation.name\" placeholder=\"\">\n            </div>\n            <div class=\"automation-id\">\n              <div class=\"id-container\">\n                <span class=\"initial-trigger\"> Automation ID <i class=\"fal fa-info-circle\" title=\"Custom Identifier for Adding Customers to this Automation\"></i></span>\n                <input class=\"input-id\" type=\"text\" :class=\"{'duplicate':duplicateId}\" v-model=\"automation.identifier\" @change=\"validateID(automation.identifier)\" placeholder=\"EG: 1, 'move-in'\">\n                <span v-if=\"duplicateId\" class=\"error-message\">Identifier Already Exists for This Location</span>\n              </div>\n              <div class=\"id-container\" style=\"margin: 0 5px;\">\n                <label style=\"margin-bottom: 10px;\">Allow Resend When Customer Is Re-Added </label>\n                <select v-model=\"automation.autoResend\">\n                  <option value=\"never\">Never</option>\n                  <option value=\"2592000000\">1 Month</option>\n                  <option value=\"7776000000\">3 Months</option>\n                  <option value=\"15724800000\">6 Months</option>\n                  <option value=\"31536000000\">1 Year</option>\n                  <option value=\"always\">Always</option>\n                </select>\n              </div>\n              <div class=\"landing-page-edit-button\">\n                <span class=\"action-landing-button\" v-if=\"!initializedUnlayer\" @click=\"editLandingPage()\"> <i class=\"fas fa-columns\"></i>Edit Landing Page</span>\n                <!-- <i class=\"fal fa-pencil\" v-if=\"!initializedUnlayer\"  title=\"Edit Landing Page Details\"></i> -->\n              </div>\n            </div>\n            <div class=\"action-container\">\n              <div class=\"automation-actions-list\" v-for=\"(action, i) in automation.actions\">\n                <!-- <div>Interaction {{i+1}} </div> -->\n                <i class=\"fas fa-plus-circle top\" @click=\"addAction('above', i)\" title=\"Add Action Here\"></i>\n                <div class=\"automation-action\">\n\n                  <!-- Segment displaying current automation actions for Time -->\n                  <div class=\"automation-action-instance\">\n                    <div class=\"action-info-row\">\n                      <span class=\"action-method-selector hidden\">Active</span>\n                      <span class=\"action-image-title\"><i class=\"far fa-clock\"></i> Time Delay</span>\n                      <span class=\"action-input\"><input type=\"number\" v-model=\"action.time\"></span>\n                      <span class=\"preview-link titled\" title=\"Delay after a customer is created until they receive this message.\">Hours</span>\n                    </div>\n                    <div class=\"action-info-row\">\n                      <span class=\"action-method-selector\" :class=\"{'empty-top': !action.email.active && !action.sms.active}\"> <input type=\"checkbox\" v-model=\"action.email.active\" /> </span>\n                      <span class=\"action-image-title\"><i class=\"far fa-envelope\"></i> Email Subject</span>\n                      <span class=\"action-input\"><input type=\"text\" v-model=\"action.email.subject\" :disabled=\"!action.email.active\"></span>\n                      <span class=\"preview-link\" @click=\"previewEmail(action)\">Preview</span>\n                    </div>\n                    <div class=\"action-info-row\">\n                      <span class=\"action-method-selector\" :class=\"{'empty-bottom': !action.email.active && !action.sms.active}\"> <input type=\"checkbox\" v-model=\"action.sms.active\" /> </span>\n                      <span class=\"action-image-title\"><i class=\"fas fa-mobile-alt\"></i> SMS Preview </span>\n                      <span class=\"action-input\"><input type=\"text\" v-model=\"action.sms.preview\" :disabled=\"!action.sms.active\"></span>\n                      <span class=\"preview-link\" @click=\"previewSMS(action)\">Preview</span>\n                    </div>\n                    <!-- <div class=\"action-info-row\" v-if=\"automationType == 'loyalty'\">\n                      <span class=\"action-method-selector\"> <input type=\"checkbox\" v-model=\"action.sms.active\" /> </span>\n                      <span class=\"action-image-title\"><i class=\"fas fa-mobile-alt\"></i> SMS /Something\\ </span>\n                      <span class=\"action-input\"><input type=\"text\" v-model=\"action.loyalty.coupon\"></span>\n                      <span class=\"preview-link\" @click=\"editLoyaltyCoupon(action)\">Preview</span>\n                    </div> -->\n                    <div class=\"action-info-row\" v-if=\"automationType == 'survey'\">\n                      <span class=\"action-method-selector\" hidden>Active </span>\n                      <span class=\"action-image-title\"><i class=\"fas fa-mobile-alt\"></i> Survey Title </span>\n                      <span class=\"action-input\"><input type=\"text\" v-model=\"action.survey.surveyTitle\"></span>\n                      <span class=\"preview-link\" @click=\"editSurvey(action)\">Set Questions</span>\n                    </div>\n                    <span class=\"remove-action\" v-if=\"automation.actions.length > 1 || i != 0\"> <i class=\"fal fa-times-circle\" @click=\"removeAction(i)\" title=\"Remove Action\"></i> </span>\n                  </div>\n                  <i class=\"fas fa-plus-circle bottom\" v-if=\"i == automation.actions.length - 1\" @click=\"addAction('below', i)\" title=\"Add Action Below\"></i>\n                </div>\n              </div>\n            </div>\n            <div class=\"bottom-container\">\n              <span class=\"cancel-button\" @click=\"closeModal()\">Cancel</span>\n              <button class=\"save-button\" :disabled=\"duplicateId || duplicateKey || !automation.name || !automation.locationId || !automation.identifier || !automation.type\" @click.once=\"saveAutomation()\">Save Automation</button>\n            </div>\n          </div>\n          <!-- Email -->\n          <div class=\"email-editor-display\" v-show=\"emailPreview\">\n            <div class=\"header-container\">\n              <span><span class=\"cancel-button\" @click=\"cancelEmailEdit()\">Cancel</span><button class=\"save-button\" @click=\"closeAllEditing()\">Save Email</button></span>\n              <span class=\"message-editor-header\">\n                <label>Subject: </label>\n                {{selectedAction.email.subject}}\n                <span class=\"error-message\" v-if=\"!selectedAction.email.subject\">No subject entered, please add a subject line.</span>\n              </span>\n            </div>\n            <!-- <div class=\"spinner\" v-if=\"spinnerActive\"><i class=\"far fa-hourglass\"></i></div> -->\n            <div class=\"campaign-email-editor\" id=\"email-editor\"></div>\n          </div>\n          <!-- SMS -->\n          <div class=\"sms-editor-display\" v-if=\"smsPreview\">\n            <div class=\"header-container\">\n              <span><span class=\"cancel-button\" @click=\"cancelSMS()\">Cancel</span><button class=\"save-button\" @click=\"saveSMS()\">Save SMS</button></span>\n            </div>\n            <div class=\"sms-design\">\n              <div class=\"phone-background\">\n                <img src=\"../assets/img/phone-background.svg\" />\n              </div>\n              <div class=\"phone-message\" v-if=\"tempMessage.length > 0\">{{tempMessage.substr(0, 135)}}</div>\n              <div class=\"phone-message\" v-if=\"tempMessage.length > 135\">{{tempMessage.substr(135, 270)}}</div>\n            </div>\n            <div class=\"sms-message\">\n              <label>Enter Your Message</label>\n              <textarea class=\"sms-text-box\" maxlength=\"270\" v-model=\"tempMessage\"></textarea>\n              <span class=\"sms-length-tracker\">{{tempMessage.length}}</span>\n            </div>\n          </div>\n          <!-- Landing Page -->\n          <div class=\"landing-page-display\" v-if=\"editingLandingPage\">\n            <div class=\"header-container landing\">\n              <!-- <button @click=\"openPreviewModal()\">Preview Landing Page</button> -->\n              <button @click=\"closeAllEditing()\">Save Landing Page</button>\n            </div>\n            <div id=\"landing-editor\">\n              <!-- <h4>Receive Notifications For: </h4>\n              <div class=\"landing-detail\">\n                <label>Potential Negative Reviews</label><input type=\"checkbox\" v-model=\"selectedAction.notice.potentialNegRev\">\n              </div>\n              <div class=\"landing-detail\">\n                <label>Actual Negative Reviews</label><input type=\"checkbox\" v-model=\"selectedAction.notice.actualNegRev\">\n              </div>\n              <div class=\"landing-detail\">\n                <label>Positive Reviews</label><input type=\"checkbox\" v-model=\"selectedAction.notice.positiveRev\">\n              </div>\n              <div class=\"landing-detail\">\n                <label>Private Feedback</label><input type=\"checkbox\" v-model=\"selectedAction.notice.privateRev\">\n              </div> -->\n              <div class=\"landing-page-details-container\">\n                <div class=\"landing-subheader\">Landing Page</div>\n                <div class=\"modal-landing-page-details\">\n                  <div class=\"landing-detail\"><label>Header </label><input v-model=\"automation.landingPage.lp1\" placeholder=\"Landing Page Title\" /></div><br />\n                  <div class=\"landing-detail\"><label>Sub Header </label><input v-model=\"automation.landingPage.lp2\" placeholder=\"Landing Page Subtitle\" /></div><br />\n                  <div class=\"landing-textarea\"><label>Message </label><textarea v-model=\"automation.landingPage.lp3\" placeholder=\"Landing Page Message\" ></textarea> </div><br />\n                <div class=\"landing-subheader\">Feedback Page</div>\n                  <div class=\"landing-detail\"><label>Header </label><input v-model=\"automation.landingPage.rp1\" placeholder=\"Review Page Title\" /></div><br />\n                  <div class=\"landing-detail\"><label>Sub Header </label><input v-model=\"automation.landingPage.rp2\" placeholder=\"Review Page Subtitle\" /></div><br />\n                  <div class=\"landing-textarea\"><label>Message </label><textarea v-model=\"automation.landingPage.rp3\" placeholder=\"Neg Feedback Content\" ></textarea></div><br/>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </transition>\n</template>\n\n<script>\nimport { EventService } from \"../main\";\nimport AutomationService from \"./../services/AutomationService\";\nimport config from \"../config.js\";\nimport LocationService from \"./../services/LocationService.js\";\nimport PreviewLanding from \"./PreviewLanding\";\nimport TCPACompliance from \"./TCPACompliance\";\nimport UserService from './../services/UserService';\n\nexport default {\n  name: \"addAutomation\",\n  props: [\"selectedAutomation\", \"automationType\"],\n  components: {\n    PreviewLanding, TCPACompliance\n  },\n  data: function() {\n    return {\n      pageAction: \"Add New\",\n      displayName: \"\",\n      locationId: \"\",\n      automationLocationName: '',\n      userData: '',\n      newOption: '',\n      tempMessage: '',\n      landingMessage: 'Edit Landing Page',\n      emailPreview: false,\n      smsPreview: false,\n      duplicateId: false,\n      duplicateKey: false,\n      editingTimeCondition: false,\n      editingLandingPage: false,\n      editingSurvey: false,\n      addingLoyaltyCoupon: false,\n      openPreviewCampaign: false,\n      tcpaComplianceOpen: false,\n      agreement: false,\n      initializedUnlayer: false,\n      spinnerActive: false,\n      startPosition: null,\n      endPosition: null,\n      dragging: false,\n      templateType: \"\",\n      selectedIndex: null,\n      selectedAction: {\n        time: 0,\n        email: {\n          active: '',\n          subject: \"\",\n          design: {\n            data: \"\",\n            design: \"\"\n          }\n        },\n        sms: {\n          active: '',\n          preview: \"\",\n          message: \"\"\n        },\n        surveyQuestions: []\n        // restriction: ''\n      },\n      automation: {\n        name: \"\",\n        automationId: '',\n        locationId: '',\n        type: \"\",\n        language: 'en',\n        identifier: '',\n        triggerEvent: \"\",\n        autoResend: '15724800000',\n        keyword: '',\n        landingPage: {\n          lp1: '',\n          lp2: '',\n          lp3: '',\n          rp1: '',\n          rp2: '',\n          rp3: ''\n        },\n        actions: [\n          {\n            time: 0,\n            email: {\n              active: true,\n              subject: \"\",\n              design: {\n                data: \"\",\n                design: \"\"\n              }\n            },\n            sms: {\n              active: true,\n              preview: \"\",\n              message:\n                \"\"\n            },\n            restriction: \"\"\n          }\n        ]\n      }\n    };\n  },\n  created() {\n    this.setInitialData();\n    let x = document.getElementsByClassName('titled');\n  },\n  computed: {\n    landingPage() {\n      return {\n        lp1: \"How Are We Doing?\",\n        lp2: \"Please Rate Your Experience\",\n        lp3: \"At \" + this.automationLocationName + \", we care about your experience and want to hear about it. Please take a moment to let us know how we're doing!\",\n        rp1: \"We're Sorry To Hear That\",\n        rp2: \"Please Tell Us More\",\n        rp3:\n        \"We take our customer feedback very seriously - please let us know how your experience was less than ideal so we can improve in the future. In order to better address the issue, please provide specifics. We appreciate your feedback!\"\n      }\n    },\n    displayOverview() {\n      if( this.emailPreview == false &&\n          this.smsPreview == false &&\n          this.editingTimeCondition == false &&\n          this.editingLandingPage == false &&\n          this.editingSurvey == false &&\n          this.addingLoyaltyCoupon == false &&\n          this.openPreviewCampaign == false &&\n          this.initializedUnlayer == false ) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    saveSurveyDisabled() {\n      // Needs some sort of trigger in order to refresh the result after one of its dependents is changed... unsure at this time how to trigger that.\n      let vm = this;\n      let test = vm.selectedAction.surveyQuestions;\n       return(test.map(e => {\n        return Object.entries(e).map(x => {\n          return (x[1].length == 0 && (typeof x[1] != 'boolean' || typeof x[1] != 'number') );\n        })\n      })).map(h => {\n        return h.includes(true)\n      })\n      this.$forceUpdate();\n    }\n  },\n  methods: {\n    setInitialData() {\n      this.locationId = localStorage.getItem(\"locationId\");\n      this.automation.locationId = this.locationId;\n      this.displayName = this.automationType;\n      this.automation.type = this.automationType;\n      this.addLandingPageData();\n      this.addSurveyData();\n      this.addLoyaltyCoupon();\n      this.displayName = this.splitAndConvertName(this.displayName);\n      if(this.selectedAutomation) {\n        this.pageAction = 'Update';\n        this.automation = this.selectedAutomation;\n      }\n      this.getUserData();\n      this.checkAgreement();\n    },\n    checkAgreement() {\n      let vm = this;\n      if(vm.locationId) {\n        LocationService.getLocation(vm.locationId).then(response => {\n          if(response.tcpaAgreement) {\n            this.agreement = response.tcpaAgreement.consent;\n          }\n        })\n      }\n    },\n    convertToCaps() {\n      let vm = this;\n      if(vm.automation && vm.automation.keyword) vm.automation.keyword = vm.automation.keyword.toUpperCase().replace(/\\s+/g, '');\n      let allKeys = []\n      AutomationService.getAutomationByType(null, 'loyalty').then(response => {\n        response.results.map(auto => {\n          allKeys.push(auto.keyword)\n        })\n        vm.duplicateKey = allKeys.includes(vm.automation.keyword) ? true : false;\n      })\n    },\n    getUserData() {\n      let vm = this;\n      vm.userData = JSON.parse(localStorage.getItem('currentUser'));\n    },\n    validateID(id) {\n      let vm = this;\n      AutomationService.getAutomationsByLocation(vm.locationId, vm.automation.type).then(response => {\n        let locationAutos = response.result\n        let allIds = []\n        locationAutos.map(auto => {\n          if(auto.status != 'deleted') {\n            if(typeof auto.identifier != 'string') {\n              allIds.push(JSON.stringify(auto.identifier));\n            } else {\n              allIds.push(auto.identifier);\n            }\n          }\n        })\n        vm.duplicateId = allIds.includes(id);\n      })\n    },\n    saveAutomation() {\n      EventService.$emit(\"loading\", \"show\");\n      let vm = this;\n      if(vm.pageAction == 'Add New') {\n        AutomationService.saveAutomation(vm.automation).then(response => {\n          if(response.success) {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"successMessage\",\n              \"Hooray! Automation Saved.\"\n            );\n            vm.closeModal('Saved');\n          } else {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"errorMessage\",\n              \"Sorry, something went wrong. Please try again.\"\n            );\n          }\n        })\n      } else {\n        AutomationService.updateAutomation(vm.automation).then(response => {\n          if(response.success) {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"successMessage\",\n              \"Hooray! Automation Saved.\"\n            );\n            vm.closeModal('Saved');\n          } else {\n            EventService.$emit(\"loading\", \"hide\");\n            EventService.$emit(\n              \"errorMessage\",\n              \"Sorry, something went wrong. Please try again.\"\n            );\n          }\n        })\n      }\n    },\n    splitAndConvertName(data) {\n      return (data.charAt(0).toUpperCase() + data.substr(1)).replace(/([A-Z])/g, \" $1\").trim();\n    },\n\n    // Logic below allowing an action to contain a new sms message, adjust the > 7 in order to change time frame difference to allow more or less time to pass between texts.\n\n    checkTime(time, index) {\n      let newArray = [];\n      this.automation.actions.map(e => {\n        newArray.push(e.time);\n      })\n      let newTimes = newArray.sort( ( a, b ) => a - b );\n      if(index == 0) {\n        return true;\n      } else if (index > 0 && time == 0){\n        return false\n      } else {\n        if(newTimes.indexOf(time) > 0) {\n          if(Math.abs(time - newTimes[newTimes.indexOf(time)-1]) > 7) {\n            return true;\n          } else {\n            return false;\n          }\n        } else  {\n          return true;\n        }\n      }\n    },\n    checkMinTimes(action){\n      let vm = this;\n      let index = vm.selectedIndex;\n      if(index == 0 ) {\n        return 0;\n      } else {\n        return vm.automation.actions[index-1].time;\n      }\n    },\n    addAction(location, index) {\n      if (this.automationType == \"reviewRequest\") {\n        var newAction = {\n          time: 0,\n          email: {\n            active: true,\n            subject: \"\",\n            design: {\n              data: \"\",\n              design: \"\"\n            }\n          },\n          sms: {\n            active: true,\n            preview: \"\",\n            message: \"\"\n          },\n          notice: {\n            potentialNegRev: true,\n            actualNegRev: true,\n            positiveRev: true,\n            privateRev: true\n          },\n\n        };\n      } else if (this.automationType == \"survey\") {\n        var newAction = {\n          time: 0,\n          email: {\n            active: true,\n            subject: \"\",\n            design: {\n              data: \"\",\n              design: \"\"\n            }\n          },\n          sms: {\n            active: true,\n            preview: \"\",\n            message: \"\"\n          },\n          surveyQuestions: []\n        };\n      } else if (this.automationtype == \"loyalty\") {\n        var newAction = {\n          time: 0,\n          email: {\n            active: true,\n            subject: \"\",\n            design: {\n              data: \"\",\n              design: \"\"\n            }\n          },\n          sms: {\n            active: true,\n            preview: \"\",\n            message: \"\"\n          },\n          loyaltyCoupon: {\n            image: '',\n            imageType: ''\n          }\n        };\n      } else {\n        var newAction = {\n          time: 0,\n          email: {\n            active: true,\n            subject: \"\",\n            design: {\n              data: \"\",\n              design: \"\"\n            }\n          },\n          sms: {\n            active: true,\n            preview: \"\",\n            message: \"\"\n          }\n        };\n      }\n      if (location == \"below\") {\n        this.automation.actions.splice(index + 1, 0, newAction);\n      } else if (location == \"above\") {\n        this.automation.actions.splice(index, 0, newAction);\n      }\n    },\n    addLandingPageData() {\n      let vm = this;\n      let selectedLocation = localStorage.getItem('locationId');\n      let locOptions = JSON.parse(localStorage.getItem('locationOptions'));\n      locOptions.map(loc => {\n        if(loc.locationId == selectedLocation) {\n          let matchedLocation = loc;\n          vm.automationLocationName = loc.displayName;\n        };\n      })\n    },\n    addSurveyData() {\n      let vm = this;\n      if (vm.automationType == \"survey\") {\n        vm.automation.actions[0].surveyQuestions = [];\n      }\n    },\n    addLoyaltyCoupon() {\n      let vm = this;\n      if(vm.automationType == 'loyalty') {\n        vm.automation.actions[0].loyaltyCoupon = {\n          image: '',\n          imageType: '',\n        }\n      }\n    },\n    removeAction(index) {\n      this.automation.actions.splice(index, 1);\n    },\n\n    previewEmail(action) {\n      let vm = this;\n      // Removes any other editing so that other email previews don't interfere.\n      vm.closeAllEditing();\n      vm.selectedAction = action;\n      vm.emailPreview = true;\n      // vm.spinnerActive = true;\n      // Checks for proper information in order to pass correct data to mailchimp for testing.\n      if (config.subDomain) {\n        var subDomain = config.subDomain;\n      }\n      if (config.baseUrl) {\n        var baseUrl = config.baseUrl;\n      }\n      // Timeout is set to be manipulated if we need more time later in a single variable.\n      var timeOut = 200;\n      // Check if the action passed into the function already has been saved, so that it is not overwritten if it is.\n      if (vm.campaign.emailDetails.design.design) {\n        // Create the script and iframe to be used to edit the email.\n        vm.$unlayerScript = {\n          id: \"email-editor\",\n          projectId: 1777,\n          displayMode: \"email\"\n        };\n\n        var d = document;\n        var s = d.createElement(\"script\");\n        s.type = \"text/javascript\";\n        s.defer = true;\n        s.src = \"//editor.unlayer.com/embed.js\";\n        var t = d.getElementsByTagName(\"script\")[0];\n        t.parentNode.insertBefore(s, t);\n        // Actually load the existing design in the action, check for initializedUnlayer exists as failsafe for the iframe not being reset properly.\n        setTimeout(() => {\n          if (!vm.initializedUnlayer) {\n            unlayer.init(vm.$unlayerScript);\n            vm.initializedUnlayer = true;\n            unlayer.loadDesign(vm.campaign.emailDetails.design.design);\n          }\n        }, timeOut);\n        // vm.spinnerActive = false;\n      } else {\n        // If email design doesn't exist for the selected action, create all necessary fields to pass as designTags and set the initial design.\n        LocationService.getLocation(vm.campaign.locationId).then(response => {\n          if (response.displayName) {\n            vm.automationLocationName = response.displayName;\n            vm.addLandingPageData();\n            var locationName = response.displayName;\n          } else {\n            var locationName = response.name;\n          }\n          var style = response.locationStyle;\n          var logo = style.logo;\n          var colors = style.buttonColor || \"#4fcbc5\";\n          var buttonColors = vm.generateButtonColors(colors);\n          var automationId = 'AU' + vm.generateAutoId('0', 11);\n          vm.automation.automationId = automationId;\n\n          vm.$unlayerScript = {\n            id: \"email-editor\",\n            projectId: 1777,\n            displayMode: \"email\",\n            designTags: {\n              location_name: locationName,\n              // Update when automation identifier is created.\n              // template_id: vm.automation.name,\n              review_url: \"https://\" + subDomain + \".opiniion.com/automationReviewEmail/\" + vm.locationId + '/' + automationId+ ':' + '*|aid|*/*|cid|*',\n              display_url: \"https://\" + subDomain + \".opiniion.com/leaveFeedback/\" + vm.locationId + '/*|cid|*/Email',\n              unsubscribe_url: \"https://\" + subDomain + \".opiniion.com/unsubscribe?cid=*|cid|*\",\n              image_url: baseUrl + `location\\/showImage\\/` + vm.locationId,\n              survey_url: baseUrl + 'surveyResponse/',\n              button_color_0: buttonColors[0],\n              button_color_1: buttonColors[1],\n              button_color_2: buttonColors[2],\n              button_color_3: buttonColors[3],\n              button_color_4: buttonColors[4],\n              footer_color: style.footerColor || \"lightgrey\"\n            }\n          };\n\n          if (vm.automationType == \"campaign\") {\n            vm.$unlayerScript.templateId = 4977;\n          } else if (vm.automationType == \"survey\") {\n            vm.$unlayerScript.templateId = 4976;\n          } else if (vm.automationType == \"loyalty\") {\n            vm.$unlayerScript.templateId = 5284;\n          } else if (vm.automationType == \"reviewRequest\") {\n            vm.$unlayerScript.templateId = 5307;\n            if (vm.templateType == \"standard\" || !vm.templateType) {\n              vm.$unlayerScript.designTags.message_block =\n                \"Thank you so much for choosing \" +\n                locationName +\n                \"! Your satisfaction is our top priority, and we'd love to hear from you. Please take a few seconds to let us know how we're doing.\";\n            } else if (vm.templateType == \"property\") {\n              vm.$unlayerScript.designTags.message_block =\n                \"Thanks for joining us! Your satisfaction is our top priority, and we'd love to hear from you. Please take a few seconds to rate your experience.\";\n            } else if (vm.templateType == \"service\") {\n              vm.$unlayerScript.designTags.message_block =\n                \"Thank you so much for choosing \" +\n                locationName +\n                \"! Your satisfaction is our top priority, and we'd love to hear from you. Please take a few seconds to let us know how we're doing.\";\n            } else {\n              vm.$unlayerScript.designTags.message_block =\n                \"Thank you so much for choosing \" +\n                locationName +\n                \"! Your satisfaction is our top priority, and we'd love to hear from you. Please take a few seconds to let us know how we're doing.\";\n            }\n          }\n\n          var d = document;\n          var s = d.createElement(\"script\");\n          s.type = \"text/javascript\";\n          s.defer = true;\n          s.src = \"//editor.unlayer.com/embed.js\";\n          var t = d.getElementsByTagName(\"script\")[0];\n          t.parentNode.insertBefore(s, t);\n          setTimeout(() => {\n            if (!vm.initializedUnlayer) {\n              vm.initializedUnlayer = true;\n              unlayer.init(vm.$unlayerScript);\n            }\n          }, timeOut);\n        // vm.spinnerActive = false;\n        });\n      }\n    },\n    // saveEmailDesign() {\n    //   let vm = this;\n    //   if (vm.initializedUnlayer) {\n    //     unlayer.exportHtml(function(data) {\n    //       vm.selectedAction.email.design = {\n    //         data: data.html,\n    //         design: data.design\n    //       };\n    //       vm.removeIframe();\n    //     });\n    //   }\n    //   // console.log(vm.selectedAction.email);\n    // },\n    previewSMS(action, i) {\n      let vm = this;\n      vm.selectedAction = action;\n      vm.tempMessage = action.sms.message;\n      // Add logic for opening only if index == 0 or display agreement.\n      // if((i == 0 && vm.automation.actions.length && vm.automation.actions.length == 1) || vm.agreement) {\n      vm.closeAllEditing();\n      vm.smsPreview = true;\n      // } else {\n      //   vm.tcpaComplianceOpen = true;\n      // }\n    },\n    changeAgreement() {\n      this.agreement = true;\n      // Activate this line of code once back end is pushed.\n      LocationService.setTCPAAgreement(this.locationId, this.userData).then(response => {\n      })\n      this.tcpaComplianceOpen = false;\n      this.previewSMS(this.selectedAction);\n    },\n    cancelSMS() {\n      this.tcpaComplianceOpen = false;\n      this.tempMessage = '';\n      this.smsPreview = false;\n    },\n    generateAutoId(possItems, length) {\n      var text = '';\n      var options = '';\n      if (possItems.indexOf('0') > -1) options += '0123456789';\n      if (possItems.indexOf('a') > -1) options += 'abcdefghijklmnopqrstuvwxyz';\n      if (possItems.indexOf('A') > -1) options += 'ABCDEFGHIkLMNOPQRSTUVWXYZ';\n      for (var i=0; i<length && options.length>0; i++) {\n        text += options.charAt(Math.floor(Math.random() * options.length));\n      }\n      return text;\n    },\n    editTimeCondition(action, index) {\n      let vm = this;\n      vm.closeAllEditing();\n      vm.selectedAction = action;\n      vm.selectedIndex = index;\n      vm.editingTimeCondition = true;\n    },\n    editLandingPage(action) {\n      let vm = this;\n      vm.closeAllEditing();\n      vm.editingLandingPage = true;\n      // if(action.email.subject) {\n      //   vm.closeAllEditing();\n      //   vm.selectedAction = action;\n      //   vm.editingLandingPage = true;\n      //   vm.landingMessage = 'Edit Landing Page Details'\n      // } else {\n      //   vm.landingMessage = 'Please create an email before designing the landing page.'\n      // }\n    },\n    editSurvey(action) {\n      let vm = this;\n      vm.closeAllEditing();\n      vm.selectedAction = action;\n      vm.editingSurvey = true;\n    },\n    editLoyaltyCoupon(action) {\n      let vm = this;\n      vm.closeAllEditing();\n      vm.selectedAction = action;\n      vm.addingLoyaltyCoupon = true;\n    },\n    openPreviewModal() {\n      // console.log(this.landingPage);\n      try {\n        localStorage.setItem('automationType', 'reviewRequest');\n        localStorage.setItem('previewData', this.landingPage);\n      } catch (error) {\n        console.log(error)\n      }\n      let route = this.$router.resolve({name: 'Preview Landing'});\n      window.open(route.href, '_blank');\n    },\n    saveSMS() {\n      let vm = this;\n      vm.selectedAction.sms.message = vm.tempMessage;\n      vm.closeAllEditing();\n    },\n    closeAllEditing() {\n      let vm = this;\n      vm.saveEmailDesign();\n      vm.emailPreview = false;\n      vm.smsPreview = false;\n      vm.editingTimeCondition = false;\n      vm.editingLandingPage = false;\n      vm.editingSurvey = false;\n      vm.addingLoyaltyCoupon = false;\n      vm.selectedIndex = null;\n    },\n    cancelEmailEdit() {\n      let vm = this;\n      vm.removeIframe();\n      vm.emailPreview = false;\n      vm.smsPreview = false;\n      vm.editingTimeCondition = false;\n      vm.editingLandingPage = false;\n      vm.editingSurvey = false;\n      vm.addingLoyaltyCoupon = false;\n    },\n    removeIframe() {\n      let vm = this;\n      if (vm.initializedUnlayer) {\n        var x = document.getElementsByTagName(\"iframe\")[0];\n        var d = document.getElementsByTagName(\"script\")[0];\n        if (x) {\n          x.remove();\n        }\n        if (d) {\n          d.remove();\n        }\n      }\n      vm.initializedUnlayer = false;\n    },\n    addAnswer(question) {\n      let vm = this;\n      question.answerOptions.push(question.newOption);\n      question.newOption = '';\n      vm.refreshQuestions();\n    },\n    removeAnswer(question, answer) {\n      let vm = this;\n      question.answerOptions.splice(question.answerOptions.indexOf(answer), 1);\n      vm.refreshQuestions();\n    },\n    closePreviewModal() {\n      this.openPreviewCampaign = false;\n    },\n    changeQuestions() {\n      let vm = this;\n      if (vm.selectedAction.surveyTemplate == \"none\") {\n        vm.selectedAction.surveyQuestions = [];\n      } else if (vm.selectedAction.surveyTemplate == \"1\") {\n        vm.selectedAction.surveyQuestions = [\n          { order: 1, type: \"1to5\", explain: true, title: \"With 1 being lowest and 5 being highest: \", question: \"How would you rate our work culture?\" },\n          { order: 2, type: \"selectAny\", explain: true, title: \"Select All That Apply:\", question: \"What do you enjoy most about working here?\", answerOptions:[] },\n          { order: 3, type: \"selectAny\", explain: true, title: \"Select All That Apply:\", question: \"What do you enjoy least about working here?\", answerOptions:[] },\n        ];\n      } else if (vm.selectedAction.surveyTemplate == \"2\") {\n        vm.selectedAction.surveyQuestions = [\n          { order: 1, type: \"1to5\", explain: true, title: \"With 1 being lowest and 5 being highest: \", question: \"How would you rate our facilties?\" },\n          { order: 2, type: \"selectAny\", explain: true, title: \"Select All That Apply:\", question: \"What do you enjoy most about living here?\", answerOptions:[] },\n          { order: 3, type: \"selectAny\", explain: true, title: \"Select All That Apply:\", question: \"What do you enjoy least about living here?\", answerOptions:[] },\n        ];\n      } else if (vm.selectedAction.surveyTemplate == \"3\") {\n        vm.selectedAction.surveyQuestions = [\n          { order: 1, type: \"1to5\", explain: true, title: \"With 1 being lowest and 5 being highest: \", question: \"How would you rate our service?\" },\n          { order: 2, type: \"selectAny\", explain: true, title: \"Select All That Apply:\", question: \"What do we do well?\", answerOptions:[] },\n          { order: 3, type: \"selectAny\", explain: true, title: \"Select All That Apply:\", question: \"What could we improve on?\", answerOptions:[] },\n        ];\n      }\n    },\n    encodeImageFileAsURL(event) {\n      let filesList = event.target.files[0];\n      let vm = this;\n      let reader = new FileReader();\n      reader.onloadend = function() {\n        if (reader.result.length > 500000 * 1.36) {\n          vm.showLogoSizeError = true;\n        } else {\n          vm.selectedAction.loyaltyCoupon.image = reader.result;\n          let selection = reader.result.substr(0, 25);\n          vm.selectedAction.loyaltyCoupon.imageType = selection.substr((selection.indexOf(\"/\")+1), (selection.indexOf(';')-1 - selection.indexOf(\"/\")));\n          vm.addingLoyaltyCoupon = false;\n          vm.addingLoyaltyCoupon = true;\n        }\n      };\n      reader.readAsDataURL(filesList);\n    },\n    appendImageHeader(imgText) {\n      if (imgText) {\n        return imgText;\n      }\n    },\n    generateButtonColors(initialColor) {\n      let vm = this;\n      return [\n        vm.lightenColor(initialColor, 40),\n        vm.lightenColor(initialColor, 30),\n        vm.lightenColor(initialColor, 20),\n        vm.lightenColor(initialColor, 10),\n        initialColor\n      ];\n    },\n    lightenColor(initialColor, amt) {\n      var col = initialColor.slice(1);\n\n      var num = parseInt(col, 16);\n\n      var r = (num >> 16) + amt;\n\n      if (r > 255) r = 255;\n      else if (r < 0) r = 0;\n\n      var b = ((num >> 8) & 0x00ff) + amt;\n\n      if (b > 255) b = 255;\n      else if (b < 0) b = 0;\n\n      var g = (num & 0x0000ff) + amt;\n\n      if (g > 255) g = 255;\n      else if (g < 0) g = 0;\n\n      return (\n        \"#\" +\n        String(\"000000\" + (g | (b << 8) | (r << 16)).toString(16)).slice(-6)\n      );\n    },\n    addSurveyQuestion() {\n      let vm = this;\n      let newOrder = vm.selectedAction.surveyQuestions.length + 1;\n      vm.selectedAction.surveyQuestions.push({\n        order: newOrder,\n        type: \"\",\n        title: \"\",\n        question: \"\"\n      });\n      vm.refreshQuestions();\n    },\n    refreshQuestions() {\n      let vm = this;\n      vm.editingSurvey = false;\n      vm.editingSurvey = true;\n    },\n    removeSurveyQuestion(index) {\n      this.selectedAction.surveyQuestions.splice(index, 1);\n      this.refreshQuestions();\n    },\n    dragStart(event) {\n      this.dragging = true;\n      let dt = event.dataTransfer;\n      dt.setData(\"text/plain\", event.target.id);\n      var el = document.getElementsByClassName(\"disable-on-drag\");\n      var i;\n      for (i = 0; i < el.length; i++) {\n        el[i].disabled = true;\n      }\n    },\n    dragOver(event) {\n      event.dataTransfer.dropEffect = \"move\";\n    },\n    dropQuestion(event) {\n      let dt = event.dataTransfer;\n      var data = event.dataTransfer.getData(\"text/plain\");\n      this.startPosition = data;\n      this.endPosition = event.target.id;\n    },\n    dragEnd(event) {\n      let vm = this;\n      let start = this.startPosition;\n      let end = this.endPosition;\n      var newArray = [];\n      if ((start && end) && start != end) {\n        vm.selectedAction.surveyQuestions.map((question, i) => {\n          if (i == start) {\n            i = end;\n            newArray[i] = question;\n          } else {\n            if (end > start) {\n              if (i > start && i <= end) {\n                i = i - 1;\n                newArray[i] = question;\n              } else {\n                newArray[i] = question;\n              }\n            } else if (end < start) {\n              if (i < start && i >= end) {\n                i = i + 1;\n                newArray[i] = question;\n              } else {\n                newArray[i] = question;\n              }\n            }\n          }\n        });\n        vm.selectedAction.surveyQuestions = newArray;\n      }\n      var el = document.getElementsByClassName(\"disable-on-drag\");\n      var i;\n      for (i = 0; i < el.length; i++) {\n        el[i].disabled = false;\n      }\n      vm.dragging = false;\n    },\n    closeModal(msg) {\n      if(msg) {\n        this.$emit(\"closeModal\");\n        this.automation = {};\n        this.selectedAction = {};\n        EventService.$emit(\"loading\", \"hide\");\n      } else {\n        if(confirm('Are you sure you would like to exit without saving?')) {\n        this.$emit(\"closeModal\");\n        this.automation = {};\n        this.selectedAction = {};\n        EventService.$emit(\"loading\", \"hide\");\n        }\n      }\n    }\n  }\n};\n</script>\n\n\n<style scoped>\n.modal-mask {\n  height: auto;\n}\n\n.automation-container {\n  width: calc(100% - 75px);\n  /* min-width: 1430px; */\n  min-height: calc(100% - 100px);\n  margin: 55px 0 0 55px;\n  background: white;\n}\n\nheader {\n  border-bottom: 2px solid lightgrey;\n  display: flex;\n  justify-content: space-between;\n  align-content: center;\n  align-items: center;\n  font-size: 25px;\n  text-transform: capitalize;\n}\n\nheader span {\n  margin-left: 25px;\n}\n\nheader i {\n  margin-right: 25px;\n}\n\n.automations-style-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.main-display {\n  min-width: 50%;\n}\n\n.automation-name {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 15px;\n}\n\n.input-name {\n  border: 1px solid lightgrey;\n  border-radius: 5px;\n  width: 250px;\n  margin-top: 15px;\n}\n\n.automation-id {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n  align-self: center;\n  margin: 10px 0;\n}\n\n.id-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.input-id {\n  border: 1px solid lightgrey;\n  border-radius: 5px;\n}\n\n.landing-page-edit-button {\n  display: flex;\n  align-items: center;\n}\n\n.action-landing-button {\n  border: 1px solid lightgrey;\n  border-radius: 5px;\n  padding: 7px 10px;\n  margin-right: 10px;\n  display: flex;\n  min-width: 160px;\n  cursor: pointer;\n}\n\n.action-landing-button i {\n  margin-right: 8px;\n  color: #4fcbc5;\n  font-size: 18px;\n}\n\n.action-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n}\n\n.automation-action {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n}\n\n.automation-actions-list {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n}\n\n.automation-action-instance {\n  border: 1px solid lightgrey;\n  border-radius: 5px;\n  padding: 20px;\n  position: relative;\n}\n\n.action-info-row {\n  display: flex;\n  justify-content: space-between;\n  align-content: center;\n  align-items: center;\n}\n\n.action-info-row span {\n  margin-bottom: 5px;\n}\n\n.action-method-selector {\n  margin-right: 5px;\n  width: 20px;\n  transform: translateY(3px);\n}\n\n.action-image-title {\n  width: 150px;\n}\n\n.action-input {\n  width: 200px;\n  border: 1px solid lightgrey;\n  border-radius: 5px;\n  margin-right: 10px;\n}\n\n.action-input input {\n  /* height: 20px; */\n  border: none;\n}\n\n.far, .fas {\n  color: #4fcbc5;\n}\n\n.preview-link {\n  cursor: pointer;\n  color: #4fcbc5;\n  width: 60px;\n}\n\n.titled {\n  cursor: help;\n  color: black;\n}\n\n.hidden {\n  opacity: 0;\n}\n\n.fa-plus-circle {\n  font-size: 30px;\n  color: #4fcbc5;\n  cursor: pointer;\n}\n\n.top {\n  margin: 20px 0;\n}\n\n.bottom {\n  margin-top: 20px;\n}\n\n.empty-top::before {\n  content: '';\n  border-left: 2px solid red;\n  display: inline-block;\n  height: 11px;\n  transform: translateY(1px);\n}\n\n.empty-bottom::before {\n  content: '';\n  border-left: 2px solid red;\n  display: inline-block;\n  height: 11px;\n  transform: translateY(1px);\n}\n\n.remove-action {\n  position: absolute;\n  right: 5px;\n  cursor: pointer;\n}\n\n/* Email Editor */\n\n.error-message {\n  color: red;\n}\n\n.email-editor-display {\n  height: 700px;\n  width: 95%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n\n.campaign-email-editor {\n  height: 600px;\n}\n\n.header-container {\n  text-align: center;\n  display: flex;\n  flex-direction: column;\n}\n\n.message-editor-header {\n  margin-bottom: 10px;\n  text-align: left;\n  font-size: 22px;\n}\n/*\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.spinner {\n  text-align: center;\n  animation: spin 3s infinite;\n} */\n\n/* SMS Editor */\n\n.sms-editor-display {\n  padding: 30px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  text-align: center;\n}\n\n.sms-design {\n  position: relative;\n}\n\n.phone-background {\n  color: grey;\n}\n\n.phone-message {\n  position: absolute;\n  top: 70px;\n  left: 200px;\n  font-size: 15px;\n  background: #d3d3d3;\n  max-width: 125px;\n  font-family: Arial, Helvetica, sans-serif;\n  padding: 5px 8px;\n  border-radius: 15px;\n  text-align: left;\n}\n\n.phone-message::after {\n  position: absolute;\n  content: '';\n  bottom: 2px;\n  left: 6px;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n  border-top-color: #d3d3d3;\n  border-bottom: 0;\n  border-left: 0;\n  margin-bottom: -9px;\n}\n\n.phone-message:nth-child(3) {\n  transform: translateY(178px);\n}\n\n.sms-message {\n  display: flex;\n  flex-direction: column;\n}\n\n.sms-message label {\n  font-size: 20px;\n  margin: 10px;\n}\n\n.sms-message span {\n  font-size: 12px;\n  margin: 3px;\n}\n\n.sms-text-box {\n  width: 550px;\n  max-width: 550px;\n  min-width: 550px;\n  height: 50px;\n  max-height: 50px;\n  min-height: 50px;\n}\n\n.sms-length-tracker {\n  text-align: left;\n}\n\n/* Landing */\n\n.landing {\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  margin: 10px 0;\n}\n\n.landing button {\n  background: #4fcbc5;\n  color: white;\n  margin-right: 20px;\n  padding: 5px 10px;\n  cursor: pointer;\n}\n\n.landing-page-details-container {\n  margin-bottom: 20px;\n}\n\n.landing-subheader {\n  margin-bottom: 10px;\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.landing-detail {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.landing-detail input {\n  width: 300px;\n  border: 1px solid lightgrey;\n  border-radius: 5px;\n}\n\n.landing-textarea {\n  display: flex;\n  flex-direction: column;\n  text-align: center;\n}\n\n.landing-textarea label {\n  margin-bottom: 5px;\n\n}\n\n.landing-textarea textarea{\n  width: 500px;\n  height: 75px;\n  min-width: 500px;\n  min-height: 75px;\n  max-width: 500px;\n  max-height: 75px;\n}\n\n\n/* Bottom Container */\n\n.bottom-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 30px;\n  padding-bottom: 20px;\n}\n\n.cancel-button {\n  color: orange;\n  cursor: pointer;\n}\n\n.save-button {\n  background: #4fcbc5;\n  color: white;\n  cursor: pointer;\n  padding: 10px 15px;\n  border-radius: 3px;\n  margin-left: 10px;\n}\n\n</style>"]}]}