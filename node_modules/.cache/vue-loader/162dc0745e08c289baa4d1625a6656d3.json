{"remainingRequest":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/src/components/LinkLocation.vue?vue&type=style&index=0&id=209a2e7f&scoped=true&lang=css&","dependencies":[{"path":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/src/components/LinkLocation.vue","mtime":1581270622000},{"path":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hamzaafzal/OLD DATA/Mac Home/vueJS/OPINIION FINAL/opiniionv4/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouY2FyZC1hY3Rpb25zIHNwYW4gewogIGZvbnQtc2l6ZTogMTRweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KLmNhcmQtYWN0aW9ucyB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwp9Ci5saW5rLWxvY2F0aW9uLXZpZXcgewoKfQoubG9jYXRpb24tbGluay1idXR0b24gewogIG1hcmdpbjogMCAwcHggMjBweCAwcHg7Cn0KCi5sb2NhdGlvbi1saW5rLWJ1dHRvbiBidXR0b24gewogIGJhY2tncm91bmQ6IGxpbWVncmVlbjsKICBwYWRkaW5nOiA1cHggMTBweDsKICBjb2xvcjogd2hpdGU7Cn0KCi5sb2NhdGlvbi10YWJsZSB7CiAgYmFja2dyb3VuZDogd2hpdGU7CiAgZm9udC1zaXplOiAxNHB4OwogIHBhZGRpbmc6IDEwcHg7CiAgY2xlYXI6IGJvdGg7Cn0KCi5sb2NhdGlvbi1oZWFkZXItcm93IHsKICB3aWR0aDogY2FsYygxMDAlIC0gMjBweCk7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgcGFkZGluZzogMTBweDsKICBib3JkZXItdG9wOiAxcHggc29saWQgI2VmZWZlZjsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VmZWZlZjsKICBoZWlnaHQ6IDE0cHg7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LXdyYXA6IG5vd3JhcDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWV2ZW5seTsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KCi5sb2NhdGlvbi1oZWFkZXItcm93IGRpdiwgLmxvY2F0aW9uLXJvdyBkaXYgewogIG1hcmdpbjogYXV0bzsKfQoKLmxvY2F0aW9uLXJvdyB7CiAgd2lkdGg6IGNhbGMoMTAwJSAtIDIwcHgpOwogIGNsZWFyOiBib3RoOwogIHBhZGRpbmc6IDEwcHg7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZmVmZWY7CiAgaGVpZ2h0OiBhdXRvOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC13cmFwOiBub3dyYXA7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1ldmVubHk7Cn0KCi5sb2NhdGlvbi1yb3c6bnRoLWNoaWxkKGV2ZW4pIHsKICAvKiBiYWNrZ3JvdW5kOiAjZWZlZmVmOyAqLwp9CgoubG9jYXRpb24tcm93OmhvdmVyIHsKICBiYWNrZ3JvdW5kOiAjZGZkZmRmOwp9CgoubG9jYXRpb24tdGFibGUtY2VsbC0xIHsKICBmbGV4OiAxIDEgMjAwcHg7Cn0KCi5sb2NhdGlvbi10YWJsZS1jZWxsLTIgewogIGZsZXg6IDEgMSAxMDBweDsKfQoKLmxvY2F0aW9uLXRhYmxlLWNlbGwtMyB7CiAgZmxleDogMSAxIDIwMHB4Owp9CgoubG9jYXRpb24tdGFibGUtY2VsbC00IHsKICBmbGV4OiAxIDEgMjAwcHg7Cn0KCi5kaXNhcHBlYXItbGVhdmUtYWN0aXZlIHsKICBhbmltYXRpb246IHNjYWxlLWRvd24gMXMgY3ViaWMtYmV6aWVyKDAuMzkwLCAwLjU3NSwgMC41NjUsIDEuMDAwKSBib3RoOwp9CgouZGlzYXBwZWFyLWVudGVyLWFjdGl2ZSB7CiAgYW5pbWF0aW9uOiBzY2FsZS11cCAxcyBjdWJpYy1iZXppZXIoMC4zOTAsIDAuNTc1LCAwLjU2NSwgMS4wMDApIGJvdGg7Cn0KCgpAa2V5ZnJhbWVzIHNjYWxlLWRvd24gewogIDAlIHsKICAgIHRyYW5zZm9ybTogc2NhbGVZKDEpOwogIH0KICAxMDAlIHsKICAgIGJhY2tncm91bmQ6ICM0ZmNiYzU7CiAgICB0cmFuc2Zvcm06IHNjYWxlWSgwKTsKICB9Cn0KCkBrZXlmcmFtZXMgc2NhbGUtdXAgewogIDAlIHsKICAgIHRyYW5zZm9ybTogc2NhbGVZKDApOwogIH0KICAxMDAlIHsKICAgIHRyYW5zZm9ybTogc2NhbGVZKDEpOwogIH0KfQo="},{"version":3,"sources":["LinkLocation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LinkLocation.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"link-location-view\">\n    <el-card>\n      <div class=\"card-actions\">\n        <el-button type=\"primary\" size=\"large\" @click=\"linkAllLocations()\" v-if=\"accessToken && !currentlyLinking\">Link locations</el-button>\n      </div>\n      <el-table size=\"medium\" :data=\"googleLocations\" class=\"card-table-min-height\" highlight-current-row>\n        <el-table-column prop=\"name\" label=\"Name\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <span>{{scope.row.locationName}}</span>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"address\" label=\"Address\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <span>{{scope.row.locationAddress1}} {{scope.row.locality}}</span>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"phone\" label=\"Phone\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <span>{{scope.row.locationPhone}}</span>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"link\" label=\"Link To\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <el-select size=\"medium\" v-model=\"scope.row.assignedLocation\" @change=\"refresh()\">\n              <el-option v-for=\"(opLoc, index) in userLocations\" :key=\"index\" :value=\"opLoc\">{{opLoc.name}}</el-option>\n            </el-select>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"location-row\" style=\"text-align: center\">\n        {{linkError}}\n      </div>\n      <div class=\"location-row\" style=\"text-align: center\" v-if=\"googleLocations.length == 0 && !loadingLists\">\n        No locations found on your Google account.\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport LocationService from './../services/LocationService'\nimport UserService from '../services/UserService';\nimport AuthService from '../services/AuthService';\nimport { EventService } from \"../main\";\n\nexport default {\n  name: 'linkLocation',\n  data: function() {\n    return {\n      googleLocations: [],\n      userLocations: [],\n      accessToken: null,\n      linkError: null,\n      loadingLists: true,\n      currentlyLinking: false\n    }\n  },\n  created() {\n    this.getLocations();\n    this.parseGoogleLocations();\n    this.accessToken = this.$route.query.gmbToken;\n    if (!this.accessToken) {\n      EventService.$emit(\n        \"errorMessage\",\n        \"No access token detected. Can't link locations!\"\n      );\n    }\n  },\n  methods: {\n    refresh() {\n      AuthService.refreshActivity();\n    },\n    getLocations() {\n      var vm = this;\n      UserService.getAllUserLocations().then(\n        function(response) {\n          var locations = response;\n          locations.sort(function(a,b) {\n            if (a.name > b.name) {\n              return 1;\n            } else if (a.name == b.name) {\n              return 0;\n            } else {\n              return -1;\n            }\n          });\n          vm.userLocations = locations;\n          vm.preselectLocations();\n        }, function(error) {\n          console.log(error);\n      });\n    },\n    parseGoogleLocations() {\n      if (this.$route.query.locationList && this.$route.query.locationList.length > 0) {\n        var unparsedLocations = this.$route.query.locationList.split('$');\n        for (var i=0; i<unparsedLocations.length; i++) {\n          var unparsedLocation = unparsedLocations[i].split(',');\n          var newLocation = {\n            locationPath: decodeURIComponent(unparsedLocation[0]),\n            locationName: decodeURIComponent(unparsedLocation[1]),\n            locationPhone: decodeURIComponent(unparsedLocation[2]),\n            locationAddress1: decodeURIComponent(unparsedLocation[3]),\n            locality: decodeURIComponent(unparsedLocation[4])\n          };\n          if (newLocation.locationPath)\n            this.googleLocations.push(newLocation);\n        }\n        this.preselectLocations();\n        this.loadingLists = false;\n      } else if (this.$route.query.gmbToken) {\n        var vm = this;\n        EventService.$emit(\"loading\", \"show\");\n        LocationService.fetchGMBLocations(this.$route.query.gmbToken).then(function(gmbLocations) {\n          EventService.$emit(\"loading\", \"hide\");\n          vm.loadingLists = false;\n          var tempLocations = [];\n          for (var j=0; j<gmbLocations.length; j++) {\n            if (gmbLocations[j] && gmbLocations[j].name) {\n              var newLocation = {\n                locationPath: gmbLocations[j].name,\n                locationName: gmbLocations[j].locationName,\n                locationPhone: gmbLocations[j].primaryPhone,\n                locationAddress1: gmbLocations[j].address.addressLines[0],\n                locality: gmbLocations[j].address.locality\n              };\n              tempLocations.push(newLocation);\n            }\n          }\n\n          tempLocations.sort(function(a,b) {\n            if (a.locationName > b.locationName) {\n              return 1;\n            } else if (a.locationName == b.locationName) {\n              return 0;\n            } else {\n              return -1;\n            }\n          });\n\n          vm.googleLocations = tempLocations;\n          vm.preselectLocations();\n        }, function(error) {\n          console.log('Error fetching GMB Locations: ', error);\n        });\n      }\n    },\n    preselectLocations() {\n      if (this.googleLocations && this.userLocations) {\n        for (let i=0; i<this.googleLocations.length; i++) {\n          for (let j=0; j<this.userLocations.length && !this.googleLocations[i].assignedLocation; j++) {\n            if (this.userLocations[j].gmb && this.userLocations[j].gmb.gmbId == this.googleLocations[i].locationPath) {\n              this.googleLocations[i].assignedLocation = this.userLocations[j];\n            }\n          }\n        }\n      }\n    },\n    linkAllLocations() {\n      var vm = this;\n      var callCount = 0;\n      var assignedCount = 0;\n      this.currentlyLinking = true;\n      this.linkError = '';\n      EventService.$emit(\"loading\", \"show\");\n      for (var i=0; i<this.googleLocations.length; i++) {\n        var thisGLoc = this.googleLocations[i];\n        if (thisGLoc.assignedLocation && thisGLoc.assignedLocation.locationId) {\n          callCount++;\n          LocationService.linkLocationGMB(thisGLoc.assignedLocation.locationId, thisGLoc.locationPath, vm.accessToken).then(\n            function(res) {\n              assignedCount++;\n              if (assignedCount == callCount) {\n                vm.$router.replace('locationList');\n                vm.currentlyLinking = false;\n                EventService.$emit(\"loading\", \"hide\");\n              }\n            }, function(error) {\n              assignedCount++;\n              if (assignedCount == callCount) {\n                vm.linkError = \"An error occurred linking this location.  Please contact support with this information: \" + error;\n                EventService.$emit(\n                  \"errorMessage\",\n                  `${vm.linkError}`\n                );\n                vm.currentlyLinking = false;\n                EventService.$emit(\"loading\", \"hide\");\n              }\n            });\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.card-actions span {\n  font-size: 14px;\n  text-align: center;\n}\n.card-actions {\n  display: flex;\n  justify-content: flex-end;\n}\n.link-location-view {\n\n}\n.location-link-button {\n  margin: 0 0px 20px 0px;\n}\n\n.location-link-button button {\n  background: limegreen;\n  padding: 5px 10px;\n  color: white;\n}\n\n.location-table {\n  background: white;\n  font-size: 14px;\n  padding: 10px;\n  clear: both;\n}\n\n.location-header-row {\n  width: calc(100% - 20px);\n  font-weight: bold;\n  padding: 10px;\n  border-top: 1px solid #efefef;\n  border-bottom: 1px solid #efefef;\n  height: 14px;\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: space-evenly;\n  cursor: pointer;\n}\n\n.location-header-row div, .location-row div {\n  margin: auto;\n}\n\n.location-row {\n  width: calc(100% - 20px);\n  clear: both;\n  padding: 10px;\n  border-bottom: 1px solid #efefef;\n  height: auto;\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: space-evenly;\n}\n\n.location-row:nth-child(even) {\n  /* background: #efefef; */\n}\n\n.location-row:hover {\n  background: #dfdfdf;\n}\n\n.location-table-cell-1 {\n  flex: 1 1 200px;\n}\n\n.location-table-cell-2 {\n  flex: 1 1 100px;\n}\n\n.location-table-cell-3 {\n  flex: 1 1 200px;\n}\n\n.location-table-cell-4 {\n  flex: 1 1 200px;\n}\n\n.disappear-leave-active {\n  animation: scale-down 1s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;\n}\n\n.disappear-enter-active {\n  animation: scale-up 1s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;\n}\n\n\n@keyframes scale-down {\n  0% {\n    transform: scaleY(1);\n  }\n  100% {\n    background: #4fcbc5;\n    transform: scaleY(0);\n  }\n}\n\n@keyframes scale-up {\n  0% {\n    transform: scaleY(0);\n  }\n  100% {\n    transform: scaleY(1);\n  }\n}\n</style>\n"]}]}